# 指令系统

## 4.1 指令格式设计

指令系统处在软/硬件交界面，能同时被硬件设计者和系统程序员看到

- 硬件设计者角度：指令系统为CPU提供功能需求（易于硬件设计）
- 系统程序员角度：通过指令系统来使用硬件，要求易于编写编译器
- 指令系统设计的好坏决定了计算机的性能和成本

### 4.1.1 指令地址码的个数

1. 一条指令必须明显或隐含包含的信息：

   - **操作码**：指定操作类型，如加、减、乘、除、传送等

   - **源操作数或其地址**：一个或多个源操作数所在的地址，如主(虚)存地址、寄存器编号、I/O端口、指令给出

   - **结果的地址**：产生的结果存放何处（目的操作数），如存储单元地址、寄存器编号、I/O端口

   - **下条指令地址**：下条指令存放何处，通常隐含在程序计数器PC中，当改变顺序时由指令给出

2. 一条指令中应该有几个地址码字段？

   <img src="C:\Users\111\AppData\Roaming\Typora\typora-user-images\image-20231023103309196.png" alt="image-20231023103309196" style="zoom:33%;" align="left"/>

### 4.1.2 指令格式设计原则

## 4.2 指令系统设计

1. 指令系统设计，必须遵循的基本原则
   - **完备性或完整性**：应能足够编制任何可计算程序
   - **兼容性**：高档机的指令系统应兼容以前低档机的指令系统
   - **均匀性**：运算指令应能对多种类型的数据进行处理
   - **可扩充性**：操作码字段要预留一定的编码空间，以便扩充

### 4.2.1 基本设计问题

### 4.2.2 操作数类型

1. 指针或地址：被看成无符号整数，用来参加运算以确定主(虚)存地址

2. 数值数据：

   - 定点数(整数)：一般用二进制补码表示


   - 浮点数(实数)：大多数机器采用IEEE 754标准


   - 十进制数：用NBCD码（8421码）表示

3. 位、位串、字符和字符串：

   - 位和位串：标志、控制和状态等信息

   - 字符和字符串：表示文本等

- IA-32指令系统
  - 基本类型：字节、字(16位)、双字(32位)、四字(64位)
  - 整数：
    - 16位、32位、64位三种2-补码表示的整数
    - 18位压缩8421 BCD码表示的十进制整数
  - 无符号整数：8、16或32位
  - 浮点数：IEEE 754（80位扩展精度浮点数寄存器）
  - 近指针：32位段内偏移（有效地址）
- MIPS指令系统
  - 基本类型：字节、半字(16位)、字(32位)、四字(64位)
  - 整数： 16位、32位、64位三种2-补码表示的整数
  - 无符号整数：16、32位
  - 浮点数：IEEE 754（32位/64位浮点数寄存器）

### 4.2.3 寻址方式

- 寻址方式的定义：指令或操作数地址的指定方式。即：根据地址找到指令或操作数的方法。

- **地址码编码**的编码原则
  - 指令地址码尽量短
  - 操作数存放位置灵活，空间应尽量大
  - 地址计算过程尽量简单

	<img src="C:\Users\111\AppData\Roaming\Typora\typora-user-images\image-20231023214516461.png" alt="image-20231023214516461" style="zoom:33%;" align="left"/>

- 寻址方式的确定

  - 没有专门的寻址方式位（由操作码确定寻址方式）

  - 有专门的寻址方式位

- 基本寻址方式

  <img src="C:\Users\111\AppData\Roaming\Typora\typora-user-images\image-20231023215247968.png" alt="image-20231023215247968" style="zoom: 33%;" align="left"/>
  
  （偏移方式：将直接方式和寄存器间接方式结合起来，有相对/ 基址/ 变址三种）

  <img src="C:\Users\111\AppData\Roaming\Typora\typora-user-images\image-20231023215554275.png" alt="image-20231023215554275" style="zoom:33%;"  align="left"/>

  - 相对寻址：
    - 指令地址码给出一个偏移量(带符号数)，基准地址隐含由PC给出。即：EA=(PC)+A （ex. MIPS’s instruction: Beq）
    - 可用来实现程序(公共子程序)的浮动或指定转移目标地址
    - 注意：当前PC的值可以是正在执行指令的地址或下条指令的地址
  - 基址寻址：
    - 指令地址码给出一个偏移量，基准地址明显或隐含由基址寄存器B给出。即：EA=(B)+A （ex. MIPS’s instructions: lw / sw）
    - 可用来实现多道程序重定位或过程调用中参数的访问
  - 变址寻址：
    - 指令地址码给出一个基准地址，而偏移量(无符号数)明显或隐含由变址寄存器I 给出。即：EA=(I)+A
    - 可为循环重复操作提供一种高效机制，如实现对线性表的方便操作
  
### 4.2.4 操作类型

- 算术和逻辑运算指令：加、减、乘、除、比较、与、或、取反等
- 移位指令：算术移位、逻辑移位、循环移位、半字交换等
- 传送指令：传送、读取、写等
- 串指令：串传送、串比较、检索、传送转换等
- 顺序控制指令：条件转移、无条件转移、跳步、调用、返回等
- CPU控制指令：停机、开中断、关中断、系统模式切换等
- 输入输出指令：CPU与外部设备交换数据或传输控制命令及状态信息

  
