# 第六章 关系数据理论

## 6.1 问题的提出

- 关系模式，是一个五元组： `R(U,D,DOM,F)` ，

- 数据依赖：是一个关系内部属性与属性之间的一种约束关系，通过属性间值的相等与否体现出来的数据间相关联系

  - **多值依赖**（Multi-Valued Dependency，MD）

  - **函数依赖** （Functional Dependency，FD）

    - Y 函数依赖于 X : X->Y ，若 X -> Y 且 Y -> X，则 X<-->Y

    - Sname = f (Sno)，一个学号只对应一个学生的姓名

## 6.2 规范化

### 6.2.1 函数依赖

函数依赖不是指关系模式R的某个或某些关系实例满足的约束条件，而是指R的所有关系实例均要满足的约束条件。

函数依赖是语义范畴的概念。只能根据数据的语义来确定函数依赖。

数据库设计者可以对现实世界作强制的规定。例如规定不允许同名人出现，函数依赖“姓名一年龄”成立。所插入的元组必须满足规定的函数依赖，若发现有同名人存在，则拒绝装入该元组。

1. 平凡的函数依赖与非平凡函数依赖：

- 在关系模式R(U)中，对于U的子集X和Y，

  - $X → Y$ 但 $Y ⊈ X$，则称 $X → Y$ 是**非平凡函数依赖**

  - $X → Y$ 但 $Y ⊆ X$，则称 $X → Y$ 是**平凡函数依赖**

- 对于任一关系模式，平凡函数依赖都是必然成立的，它不反映新的语义。因此若不特别声明， 我们总是讨论非平凡函数依赖

2. 完全函数依赖与部分函数依赖：

   - 在R(U)中，如果 $X → Y$，并且对于 X 的任何一个真子集 $X'$，都有 $X' ↛  Y$，则称 Y 对 X **完全函数依赖**，记作 $X \stackrel{F}{\longrightarrow}Y$

   - 若 $X → Y$，但 Y 不完全函数依赖于 X，则称 Y 对 X **部分函数依赖**，记作 $X Y$

3. 传递函数依赖：
   - 在R(U)中，如果 $X → Y$（$Y ⊈ X$），$Y ↛  X$，$Y → Z$，$Z ⊈ Y$，则称  对 X **传递函数依赖**，记为：$X \stackrel{传递}{\longrightarrow}Y$

### 6.2.2 码

候选码：K为R<U,F>中的属性或属性组合，若 $K \stackrel{F}{\longrightarrow} U$​，则K为R的候选码。候选码多于1个，则选一个作主码

超码：$K \to U$，K为超码

包含在任何一个候选码中的属性称为：主属性

不包含在任何候选码中的属性称为：非主属性

全码（整个属性组是码）

### 6.2.3 范式

规范化 ：一个低一级范式的关系模式，通过模式分解可以转换为若干个高一级范式的关系模式的集合，这种过程就叫规范化。

### 6.2.4 1NF

第一范式（1NF）：作为二维表，关系要符合一个最基本的条件：每个分量必须是不可分开的数据项。（属性不可再分）

### 6.2.5 2NF

若关系模式 $R∈1NF$，并且每一个非主属性都完全函数依赖于任何一个候选码，则 $R∈2NF$

### 6.2.6 3NF

设关系模式 $R<U,F>∈1NF$，若 R 中不存在这样的码 X、属性组 Y 及非主属性 Z（$Z ⊈Y$），使得 $X→Y$，$Y→Z$ 成立，$Y ↛ X$ 成立，则称 $R<U,F> ∈ 3NF$。 （没有传递依赖）

### 6.2.7 BCNF

在关系模式 R 中，如果每一个决定属性集都包含候选码，则 R∈BCNF 

- 决定属性集：函数依赖的自变量： 
  - 设关系模式 R∈1NF，若 X →Y 且 Y ⊈ X 时 X 必含有码，则 R∈BCNF。 
- 所有非主属性都完全函数依赖于每个候选码（2NF 的性质）
- 所有主属性都完全函数依赖于每个不包含它的候选码
- 没有任何属性完全函数依赖于非码的任何一组属性

- 好处和消解方法
  - 在函数依赖的范畴实现了彻底的分离，消除了插入和删除的异常
  - 3NF 的不彻底性表现在可能存在主属性对码的部分依赖和传递依赖

## 6.3 数据依赖的公理系统

自反律：

增广律：$X \to Y$，且 $Z ⊆ U$，则 $XZ \to YZ$

传递律：$X \to Y$，且 $Y \to Z$，则 $X \to Z$

合并规则：$X \to Y$，且 $X \to Z$，则 $X \to YZ$

伪传递规则：$X \to Y$，且 $WY \to Z$，则 $XW \to Z$

分解规则：$X \to Y$，且 $Z ⊆ Y$，则 $X \to Z$

属性集闭包

极小函数依赖集

## 6.4 模式的分解

模式分解的无损连接性和保持函数依赖性