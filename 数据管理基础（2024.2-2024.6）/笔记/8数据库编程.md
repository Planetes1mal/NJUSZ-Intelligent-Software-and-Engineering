# 第八章 数据库编程

## 8.1 嵌入式 SQL

### 8.1.1 嵌入式 SQL 的处理过程

（在C语言中）嵌入式SQL语句

- 带有前缀 ‘EXEC SQL’ 和后缀 ‘;’
- 使用 into子句 来获取结果元组值（SELECT ... INTO ... 或 FETCH ... INTO ...）
- 用主变量 ‘:host_var’ 保存查询结果元组中的属性值
  通过前缀‘:’来区分主变量和SQL语言中的表名或属性名（也被称为SQL变量）

### 8.1.2 嵌入式SQL语句与主语言之间的通信

数据库工作单元与源程序工作单元之间的通信
① 向主语言传递SQL语句的执行状态信息，使主语言能够据此控制程序流程，主要用SQL通信区实现
② 主语言向SQL语句提供执行参数，主要用（输入）主变量实现
③ 将SQL语句查询数据库的结果交给主语言处理，主要用（输入）主变量和游标实现

1、SQL 通信区

用 `EXEC SQL INCLUDE SQLCA` 定义

SQLCA中有一个用于存放每次执行SQL语句后返回当前SQL语 句执行状态的代码变量SQLCODE

如果SQLCODE等于预定义的常量SUCCESS，则表示SQL语 句成功，否则表示出错

应用程序每执行完一条SQL 语句之后都应该测试一下 SQLCODE的值，以了解该SQL语句执行情况并做相应处理。

2、主变量

在SQL语句中使用的主语言程序变量简称为主变量

主变量的类型
输入主变量：由应用程序对其赋值，在SQL语句引用
输出主变量：由SQL语句对其赋值或设置状态信息，返回给应用程序
指示变量