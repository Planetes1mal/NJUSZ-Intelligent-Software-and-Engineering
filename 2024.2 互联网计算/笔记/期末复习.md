[TOC]

# 1 计算机网络和因特网

## 什么是主机 / 端系统、分组、协议

- **主机 / 端系统**：与因特网相连的计算机和其他设备；容纳应用程序
  - 客户
  - 服务器

- **分组**：为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块，并为每段加上首部字节
- **协议**：协议定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文的发送 / 接收或其他事件所采取的操作
  - 网络协议：控制收发信息
  - 互联网协议：IETF、RFC

## 客户、服务器

- 客户：桌面 PC、移动 PC、手机

- 服务器：存储和发布 Web 页面、流视频、中继电子邮件等

- 客户主机从服务器请求和接收服务

## 电路交换和分组交换的对比

- 数据怎样通过网络传输？
  - 电路交换：为每个呼叫预留一条专有电路：如电话网
  - 分组交换：分组、路由器之间传输、采用链路的最大传输能力（带宽）

- **分组交换**：
  - 分组：将长报文划分为较小的数据块
  - 分组交换机：路由器、链路层交换机
  - 分组交换: 分组的存储转发一段一段从源端传到目标端，按照有无网络层的连接，分成：
    （1）数据报网络：分组的目标地址决定下一跳；在不同的阶段，路由可以改变
    （2）虚电路网络：每个分组都带标签（虚电路标识VC ID），标签决定下一跳
    				 在呼叫建立时决定路径，在整个呼叫中路径保持不变
    				 路由器维持每个呼叫的状态信息
  - 存储-转发：分组每次移动一跳（ hop ）
    - **存储转发传输**：在交换机开始向输出链路传输该分组的第一个比特之前，必须接收到整个分组
    - 在一个速率为 R bps 的链路，一个长度为 L bits 的分组的存储转发延时： L/R s
  - 排队和延迟：
    - 如果到达速率 > 链路的输出速率：
      （1）分组将会排队，等待传输
      （2）如果路由器的缓存用完了，分组将会被抛弃
  - 转发表和路由选择协议
    - IP 地址：分组首部包含目的地的 IP 地址
    - 转发表：将目的地地址映射为输出链路
    - 路由选择协议：自动设置转发表
  - 统计多路复用

- **电路交换**：端到端的资源被分配给从源端到目标端的呼叫“call”：每个呼叫一旦建立起来就能够保证性能
  如果呼叫没有数据发送，被分配的资源就会被浪费(no sharing)

  - 为呼叫预留端-端资源


  - 网络资源（如带宽）被分成片
    - 为呼叫分配片
    - 如果某个呼叫没有数据，则其资源片处于空闲状态（不共享）


  - 电路交换中的复用

    - 频分复用 FDM

    - 时分复用 TDM

      <img src="./期末复习/image-20240518135825925.png" alt="image-20240518135825925" style="zoom: 50%;" align="left"/>


  - 电路交换不适合计算机之间的通信
    （1）连接建立时间长
    （2）计算机之间的通信有突发性，如果使用线路交换，则浪费的片较多

- **对比**：
  - 同样的网络资源，分组交换允许更多用户使用网络
  - 分组交换的性能由于电路交换

## 节点处理时延、排队时延、传输时延、传播时延、吞吐量

- 时延：
  - 四种类型：节点处理时延、排队时延、传输时延、传播时延，相加得到节点总时延
  - **节点处理时延**：检查bit级差错；检查分组首部和决定将分组导向何处
  - **排队延时**：在输出链路上等待传输的时间；依赖于路由器的拥塞程度
    - R=链路带宽(bps)
      L=分组长度(bits)
      a=分组到达队列的平均速率
      流量强度= La/R
      - La/R ~ 0：平均排队延时很小
      - La/R -> 1：延时变得很大
      - La/R > 1：比特到达队列的速率超过了从该队列输出的速率，平均排队延时将趋向无穷大
  - **传输时延**
    - L：该分组的长度，R表示从路由器A到路由器B的链路传输速率，传输时延是L/R
  - **传播时延**：某比特从该链路的起点到路由器B传播所需要的时间是传播时延，传播速率取决于该链路的物理媒介
    - 传播时延等于两台路由器之间的距离d除以传播速率s，即d/s

- **丢包**

  - 链路的队列缓冲区容量有限；当分组到达一个满的队列时，该分组将会丢失
  - 丢失的分组可能会被前一个节点或源端系统重传，或根本不重传

- **吞吐量**：在源端和目标端之间传输的速率（数据量/单位时间）
- 瞬间吞吐量: 在一个时间点的速率
  
- 平均吞吐量: 在一个长时间内平均值
  
- **瓶颈链路**：端到端路径上，限制端到端吞吐的链路。
  
  - 其他节点都不传输，吞吐量$min\{R_s,R_c\}$
  
  - 端到端平均吞吐 $= min\{R_1，R_2,…,R_n\}$

## 5层因特网协议栈、每层的作用（术语：报文、报文段、数据报、帧）

  - 网络设计者以分层的方式组织协议并实现这些协议的网络硬件和软件

  - 某层向上一层提供服务，即一层的服务模型

  - 各层的所有协议被称为协议栈

  - OSI – The Model

    - **应用层**：网络应用程序以及其应用层协议留存的地方
      - 位于应用层的信息分组称为**报文**
    - **运输层**：在应用程序端点之间传送应用层报文
      - 运输层的分组称为**报文段**
      - **网络层**：将称为**数据报**的网络层分组从一台主机移动到另一台主机

    - **链路层**：将整个帧从一个网络元素移动到邻近的网络元素
      - 链路层分组称为**帧**

    - 物理层：将比特从一个节点移动到下一个节点

- **封装**
  - 一个应用层报文被传送给运输层，并被附加上运输层首部信息，构成运输层报文段
  - 运输层向网络层传递该报文段，网络层增加了网络层首部信息，生成网络层数据报
  - 链路层增加链路层首部信息，生成链路层帧
  - 每一层，一个分组具有两种类型的字段：首部字段和有效载荷字段，有效载荷字段来自上一层的分组

# 2 应用层

## 客户-服务器体系结构、对等体系结构

- **客户-服务器体系结构**

  - 服务器：

    - 一直运行

    - 固定的 IP 地址和周知的端口号（约定）

    - 扩展性：数据中心


  - 客户端：

    - 主动与服务器通信

    - 与互联网有间歇性的连接

    - 可能是动态的 IP 地址

    - 不直接与其他客户端通信


- **对等体系结构**

  - 几乎没有一直运行的服务器

  - 任意端系统之间可以进行通信

  - 每一个节点既是客户端又是服务器
    - 自扩展性：新peer节点带来新的服务能力和新的服务请求

  - 参与的主机间歇性连接且可以改变 IP 地址（难以管理）

## TCP和UDP的区别

- TCP 服务：面向连接的服务和可靠的数据传输服务

  - 面向连接的服务：TCP连接：连接双方的进程可以在此连接上同时进行报文收发

  - 可靠的数据传输服务


  - 拥塞控制机制

- UDP 服务：不提供不必要服务的轻量级运输协议。轻量级运输协议

  - 无连接

  - 不可靠数据服务

  - 无拥塞控制机制

## 什么是HTTP、HTTP的请求-响应行为、URL由哪两部分组成

- HTTP：超文本传输协议

  由客户程序和服务器程序实现，客户/服务器模式

  - 客户：请求、接收和显示Web对象的浏览器
  - 服务器：对请求进行响应，发送对象的Web服务器

  HTTP 使用 TCP 作为它的支撑运输协议
  HTTP是无状态的。服务器并不维护关于客户的任何信息

- HTTP的请求-响应行为

  - **非持续 HTTP**

    - 最多只有一个对象在TCP连接上发送
      下载多个对象需要多个TCP连接
      HTTP/1.0使用非持久连接

    - **往返时间**（RTT）：一个短分组从客户到服务器然后再返回客户所花费的时间

      - 一个RTT用来发起TCP连接


      - 一个 RTT用来HTTP请求并等待HTTP响应


      - 文件传输时间
    
        共：2RTT+传输时间
    
        <img src="E:\大二下\互联网计算\笔记\2应用层\image-20240519220310346.png" alt="image-20240519220310346" align="left" style="zoom:80%;" />

  - **持续 HTTP**
    - 非持续 HTTP 的缺点：
      	每个对象要2个 RTT
      	操作系统必须为每个 TCP 连接分配资源
      	但浏览器通常打开并行 TCP 连接，以获取引用对象
    - 持续 HTTP
      - 服务器在发送响应后，仍保持 TCP连接
      - 在相同客户端和服务器之间的后 续请求和响应报文通过相同的连接进行传送
      - 客户端在遇到一个引用对象的时候，就可以尽快发送该对象的请求

- URL 组成：存放对象的服务器主机名、对象的路径名

  - URL格式：Prot://user:psw@www.someSchool.edu/someDept/pic.gif:port

    ​		协议名 用户：口令     主机名                                路径名               端口

## 因特网电子邮件的三个组成部分、每部分的主要作用

- 三个组成部分
  - **用户代理**
    - 撰写、保存、回复、转发和阅读邮件
    - 输入和输出邮件保存在服务器上
  - **邮件服务器**
    - 邮箱中管理和维护发送给用户的邮件
    - 输出报文队列保持待发送邮件报文
    - 邮件服务器之间的SMTP协议：发送email报文
      - 客户：发送方邮件服务器
      - 服务器：接收端邮件服务器
  - **简单邮件传输协议（SMTP）**
    - 使用TCP在客户端和服务器之间传送报文，端口号为25；使用持续连接
    - 直接传输：从发送方服务器到接收方服务器
    - 传输的3个阶段：握手、传输报文、关闭
    - 命令/响应交互
      - 命令：ASCII文本
      - 响应：状态码和状态信息
    - 报文必须为7位ASCII
  
  - 邮件访问协议
  
    - SMTP：传送到接收方的邮件服务器
  
    - 邮件访问协议：从服务器访问邮件
      - POP：邮局访问协议（Post Office Protocol）[RFC 1939]
        - 用户身份确认 （代理<-->服务器） 并下载
      - IMAP：Internet邮件访问协议（Internet Mail Access Protocol）[RFC 1730]
        - 更多特性（更复杂）
        - 在服务器上处理存储的报文
      - HTTP：Hotmail , Yahoo! Mail等。方便

## SMTP的基本操作

- A 调用它的邮件代理程序并提供 Bob 的邮件地址，撰写报文，然后指示用户代理发送该报文
- A 的用户代理把报文发到它的邮件服务器，在那里该报文被放在报文队列中
- 客户 SMTP 在 25 号端口建立一个到服务器 SMTP 的 TCP 连接。如果服务器没有开机，客户会在稍后继续尝试连接。一旦连接建立，服务器和客户执行某些应用层的握手。在握手阶段，SMTP 客户指示发送方的邮件地址和接收方的邮件地址，之后客户发送该报文
- 在 B 的邮件服务器上，SMTP 的服务器接收该报文。B 的邮件服务器将该报文放入 Bob 的邮箱中

## 推协议、拉协议

- 推协议，可理解为信息供应方驱动；拉协议，可理解为信息需求方驱动。
- HTTP 是一个**拉协议**，用户从服务器上拉取信息。
- SMTP 是一个**推协议**，发送方邮件服务器把文件推送到接收邮件服务器。

## 域名系统的作用、DNS服务器的层次结构、DNS中的递归查询和迭代查询

- 域名系统（DNS）的作用
  - 实现主机名到 IP 地址的转换
  - 其它目的：
    - 主机别名到规范名字的转换：Host aliasing
    - 邮件服务器别名到邮件服务器的正规名字的转换：Mail server aliasing
    - 负载分配：Load Distribution

- DNS 服务器的层次结构

  - **根 DNS 服务器**
  - **顶级域（TLD）DNS 服务器**：
    - Internet 根被划为几百个顶级域；每个（子）域下面可划分为若干子域
    - 域名（Domain Name）
      - 从本域往上，直到树根；中间使用“.”间隔不同的级别
      - 域的域名：可以用于表示一个域
        主机的域名：一个域上的一个主机
      - 域名的管理
        - 创建一个新的域，必须征得它所属域的同意
      - 域与物理网络无关
        - 域遵从组织界限，而不是物理网络
        - 一个域的主机可以不在一个网络；一个网络的主机不一定在一个域
        - 域的划分是逻辑的，而不是物理的
  - **权威 DNS 服务器**：组织机构
    - 区域（zone）
      - 区域的划分有区域管理者自己决定
      - 将DNS名字空间划分为互不相交的区域，每个区域都是树的一部分
      - 名字服务器：每个区域都有一个名字服务器：维护着它所管辖区域的权威信息（authoritative record）
        - 名字服务器允许被放置在区域之外，以保障可靠

  - **本地 DNS 服务器**

- DNS 中的递归查询和迭代查询
  - **递归查询**：名字解析负担都放在当前联络的名字服务器上
  - **迭代查询**：
    - 根（及各级域名）服务器返回的不是查询结果，而是下一个NS的地址
    - 最后由权威名字服务器给出解析结果
    - 当前联络的服务器给出可以联系的服务器的名字

# 3 运输层

## 运输层的多路复用与多路分解

1. **多路分解**：将运输层报文段中的数据交付到正确的套接字的工作
2. **多路复用**：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息从而生成报文段，然后将报文段传递到网络层，以上所有工作

3. 多路分解的工作原理：
   - 主机上的每个套接字能分配一个端口号，当报文段到达主机，运输层检查报文段中的端口号，并将其定向到相应的套接字
   - 主机收到 IP 数据报
     - 每个数据报有源 IP 地址和目标地址
     - 每个数据段承载一个运输层报文段
     - 每个报文段有一个**源端口号字段**和**目的端口号字段**

- **无连接（UDP）的多路复用与多路分解**

  - 创建套接字

  - 接收端：UDP 套接字用二元组标识（目标 IP 地址和目的端口号）

  - 当主机接收到 UDP 报文段：

    - 检查报文段的目标端口号

    - 用该端口号将报文段定向到相应的套接字

  - 如果两个不同源 IP 地址 / 源端口号的 UDP 报文段，但有相同的目的 IP 地址和目的端口号，则被定向到相同的目的进程

- **面向连接（TCP）的多路复用与多路分解**
  - TCP 套接字由一个四元组标识（源 IP 地址、源端口号、目的 IP 地址、目的端口号）
  - 当一个 TCP 报文段从网络到达一台主机，该主机使用全部 4 个值来将报文段定向（分解）到相应的套接字
  - 两个具有不同源 IP 地址或源端口号的到达 TCP 报文段将被定向到两个不同的套接字，除非 TCP 报文段携带了初始创建连接的请求
  - 服务器主机可以支持多个并行的 TCP 套接字，每个套接字与一个进程联系，并由四元组标识

## UDP套接字、TCP套接字

**套接字**：应用进程与端到端传输协议（TCP或UDP）之间的门户

- **TCP套接字**

  - TCP服务：从一个进程向另一个进程可靠地传输字节流

  - 服务器首先运行，等待连接建立

    1. 服务器进程必须先处于运行状态
       - 创建欢迎socket
       - 和本地端口捆绑
       - 在欢迎socket上阻塞式等待接收用户的连接

  - 客户端主动和服务器建立连接：

    2. 创建客户端本地套接字（隐式捆绑到本地port）
       - 指定服务器进程的IP地址和端口号，与服务器进程连接

    3. 当与客户端连接请求到来时：
       - 服务器接受来自用户端的请求，解除阻塞式等待，返回一个新的socket（与欢迎socket不一样），与客户端通信
         - 允许服务器与多个客户端通信
         - 使用源IP和源端口来区分不同的客户端

    4. 连接 API 调用有效时，客户端 P 与服务器建立了 TCP 连接

- **UDP 套接字**

  - UDP：在客户端和服务器之间没有连接

    - 发送端在每一个报文中明确地指定目标的IP地址和端口号


    - 服务器必须从收到的分组中提取出发送端的IP地址和端口号

## 为什么有些应用更适合用UDP、UDP中的检验和计算

- 有些应用更适合用 UDP 的原因：

  - 关于发送什么数据以及何时发送的应用层控制更为精细

  - 无须建立连接。UDP 在开始传输数据前不需要握手，即无建立连接的时延

  - 无连接状态。TCP 需要在端系统中维护连接状态，包括接收 / 发送缓存、拥塞控制参数和序号与确认号的参数。UDP 不维护且不跟踪

  - 分组首部开销小。UDP 8 字节，TCP 20 字节

- **检验和计算**
  - 发送方：
    - 对报文段中的所有 16 比特字的和进行反码运算
    - 求和时遇到的任何溢出都被回卷
    - 得到的结果放在 UDP 报文段中的检验和字段
  3. 接收方：
     - 计算接收到的报文段的检验和
     - 检查计算出的检验和与检验和字段的内容是否相等
       - 不相等：差错
       - 相等：没有检测到差错，可能有

## TCP的肯定确认、否定确认、自动重传请求协议

1. **自动重传请求（ARQ）协议**：**肯定确认**和**否定确认**

   - 差错检测：使接收方检测到何时出现了比特差错
   - 接收方反馈：（肯定确认（ACK）和否定确认（NAK））
   - 重传：发送方接收到NAK，表示接收方没有正确接收数据，则将出错的数据重新向接收方发送

2. 发送方和接收方的有限状态机（FSM）如下：

   <img src="./3运输层/image-20240609152321140.png" alt="image-20240609152321140" style="zoom: 80%;" />

3. 处理受损 ACK 和 NAK

   - 增加足够的检验和比特

   - 重传：冗余分组
     - 在数据分组中添加一新字段，让发送方对其数据分组编号，即**序号**，接收方检测序号
     - **停等协议**：发送方发送一个分组，然后等待接收方的应答

4. rdt 2.1

   - 发送方
     - 在分组中加入序列号，两个序列号（0，1）就足够了
     - 必须检测 ACK / NAK 是否出错
     - 状态数变成了两倍

   ![image-20240609152949818](./3运输层/image-20240609152949818.png)

   

   - 接收方

     - 必须检测接收到的分组是否是重复的
     - 接收方并不知道发送方是否正确收到了其 ACK / NAK

     ![image-20240609153010560](./3运输层/image-20240609153010560.png)

5. rdt2.2：无 NAK 的协议

   - 接收方对最后正确接收的分组发 ACK，以替代 NAK

   - 当收到重复的 ACK（如：再次收到 ack0）时，发送方与收到 NAK 采取相同的动作：重传当前分组

     ![image-20240609153252012](./期末复习/image-20240609153252012.png)

## 停等协议、比特交替协议的基本原理

- **停等协议**：每发送一个报文段后就停下来等待接收方的确认

  - 工作过程
    - 发送方发送经过差错编码和编号的报文段，等待接收方的确认。
    - 接收方如果差错检测无误且序号正确，则接收报文段，并向发送方发送ACK，否则丢弃报文段，并向发送方发送NAK。
    - 发送方如果收到ACK，则继续发送后续报文段，否则重发刚刚发送的报文段。

  - 处理受损 ACK 和 NAK

    - 增加足够的检验和比特
    - 重传：冗余分组
      - 在数据分组中添加一新字段，让发送方对其数据分组编号，即**序号**，接收方检测序号
  - rdt 2.1 
    - 发送方
      - 在分组中加入序列号，两个序列号（0，1）就足够了
      - 必须检测 ACK / NAK 是否出错
      - 状态数变成了两倍
    - 接收方

      - 必须检测接收到的分组是否是重复的
      - 接收方并不知道发送方是否正确收到了其 ACK / NAK
  - rdt2.2：无 NAK 的协议

    - 接收方对最后正确接收的分组发 ACK，以替代 NAK

    - 当收到重复的 ACK（如：再次收到 ack0）时，发送方与收到 NAK 采取相同的动作：重传当前分组

- **比特交替协议**：

  - 经具有比特差错的丢包信道的可靠数据传输：rdt3.0

    1. 发送方等待ACK一段合理的时间

       - 发送端超时重传：如果到时没有收到 ACK -> 重传
       - 需要一个倒计数定时器

    2. 发送方 FSM

       ![image-20240609153432995](./期末复习/image-20240609153432995.png)

    3. 运行

       ![image-20240609153502900](./期末复习/image-20240609153502900.png)

       ![image-20240609153542754](./期末复习/image-20240609153542754.png)

       - 过早超时（延迟的ACK）也能够正常工作；但是效率较低，一半的分组和确认是重复的
       - 设置一个合理的超时时间也是比较重要的

## 回退N步、选择重传的基本原理

- 滑动窗口协议：

  - 发送方依序按流水线方式发送分组，接收方接收分组，按序向上提交。

  - 发送方对于已发送未收到确认的分组，必须缓存，必要时重发。

  - 发送方可以连续发送多个未收到确认的分组（取决于缓存能力）。

  - 接收方对未按序到达的分组，必须缓存或者丢弃并确认（取决于缓存能力）。

  - 发送窗口（Ws）：发送方可以发送未被确认分组的最大数量；

    接收窗口（Wr）：接收方可以缓存的正确到达的分组的最大数量；

1. **回退 N 步**

   - 允许发送方发送多个分组而不需等待确认，不能超过 N

   - 发送窗口WS≥1 ，接收窗口Wr=1。发送端缓存能力高，可以在没有得到确认前发送多个分组。接收端缓存能力很低，只能接收1个按序到达的分组，不能缓存未按序到达的分组。

   - **基序号（base）**：最早未确认分组的序号，**下一个序号（nsxtseqnum）**：最小的未使用序号

   - **窗口长度** N：[base, nextseqnum - 1] 段内已经发送但未被确认的分组

   - GBN发送方响应的3类事件：

     - 上层的调用：窗口未满，用下一个序号编号并发送分组，否则拒绝发送新的数据

     - 收到 1 个 ACK：GBN 采用**累积确认**方式，即发送方收到 ACK n 时，表明接收方正确接收序号 n 以及序号小于 n 的所有分组

     - 超时事件：发送方只使用一个计时器，对“基序号”指向的分组计时。如超时，重发当前发送窗口中所有已发送但未确认的分组，即“回退N步”，因为接收方Wr=1，无缓存能力

   - GBN的接收方操作：Wr=1，只能接收“基序号”所指向的分组。如接收方正确接收到序号为基序号，则发送一个 ACK n，接收窗口滑动到序号 n+1 的位置。接收到的序号不是 n 或者分组差错等，则发送ACK n-1

   - 在差错较低的情况下，信道利用率会得到很大提高。如果信道误码率或者丢包率较高，导致大量重发，信道传输能力降低。

   - GBN适合低误码率、低丢包率、带宽高时延积信道，且对接收方缓存能力要求低。

2. **选择重传**
   - 选择重传（SR）通过让发送方仅重传那些未被接收确认（出错或者丢失）的分组，避免了不必要的重传
   - 发送窗口 WS＞1，接收窗口 Wr＞1。很多 SR 协议 WS 、Wr 大小相等。发送端缓存能力高。接收端缓存能力高
   - SR发送方响应事件：

     - 上层调用，请求发送数据：检查“下一个序号”，位于发送窗口内则发送，否则缓存或者返回给上层。
     - 计时器超时。发送方对每个分组进行计时，超时则重发该分组。
     - 收到 ACK。SR 协议对 n 进行判断。如 n 在当前窗口内，则标记已接收（刚好是基序号，窗口向右滑动到最小未被确认序号处）；其他情形不做响应。
   - SR接收方主要操作：

     - 正确接收到序号在接收窗口范围内的分组 PTK n，发送 ACK n，窗口滑动。
     - 正确接收到序号在接收窗口左侧的分组 PTK n，这些分组在之前已经正确接收并提交，丢弃 PTK n，并发送 ACK n，窗口不滑动。
     - 其他情况，直接丢弃分组，不做任何响应。

## 流量控制、拥塞控制

1. **流量控制**

   - 消除发送方使接收方缓存溢出的可能性
   2. TCP 通过让发送方维护一个称为**接收窗口**的变量来提供流量控制

      - 接收窗口用于给发送方一个指示——该接收方还有多少可用的缓存空间
      - 因为 TCP 是全双工通信，在连接两端的发送方都各自维护一个接收窗口

   3. 主机 A 向主机 B 发送大文件，主机 B 为该连接分配了一个接收缓存，并用**RevBuffer** 来表示其大小

      - **LastByteRead**：主机 B 上的应用进程从缓存读出的数据流的最后一个字节的编号
      - **LastByteRcvd**：从网络中到达的并且已放入主机 B 接收缓存中的数据流的最后一个字节的编号
      - $\text{LastByteRcvd}-\text{LastByteRead} \leq \text{RevBuffer}$
      - 接收窗口用 rwnd 表示，根据缓存可用空间的数扯来设置：$\text{rwnd} = \text{RevBuffer} - [\text{LastByteRcvd}-\text{LastByteRead}]$

      - 主机B 通过把当前的 rwnd 值放入它发给主机 A 的报文段接收窗口字段中，通知主机 A 它在该连接的缓存中还有多少可用空间

      - 主机 A 轮流跟踪两个变量， LastByteSent 和 LastByteAcked。LastByteSent - LastByteAcked = 主机 A 发送到连接中但未被确认的数据量。$\text{LastByteSent}-\text{LastByteAcked} \leq \text{rwnd}$​

2. **拥塞控制**

   - 拥塞的表现：分组丢失（路由器缓冲区溢出）、分组经历长延迟（在路由器的队列中排队）

   - 拥塞的原因与代价：

     1. 情况1：2个发送端，2个接收端和 1 台具有无穷大缓存的路由器

        - 输出链路带宽：R，发送端提供流量的速率 $\lambda_{in}$ 字节 / 秒
     
        - 没有重传

          <img src="./3运输层/image-20240610201025750.png" alt="image-20240610201025750" style="zoom:67%;" />

        - 代价1：当分组的到达速率接近链路容量时，分组经历巨大的排队时延。

     2. 情况2：两个发送方和一台具有有限缓存的路由器

        - 应用层输入 = 应用层输出：$\lambda_{in} = \lambda_{out}$

        - 运输层向网络中发送报文段 $\lambda_{in}'$ 包括重传：$\lambda_{in}' \geq \lambda_{in}$（$\lambda_{in}'$ 供给载荷）

        - 理想情况：发送端知道什么时候路由器的缓冲是可用的，不会产生丢包，且 $\lambda_{in}' = \lambda_{in}$

          <img src="./3运输层/image-20240610201619278.png" alt="image-20240610201619278" style="zoom:67%;" />

        - 情况2：发送方仅当在确定了一个分组已经丢失时才重传

          <img src="./3运输层/image-20240610201843819.png" alt="image-20240610201843819" style="zoom:67%;" />

        - 现实情况：发送方也许会提前发生超时并重传在队列中已被推迟但还未丢失的分组

        - 代价2：发送方在遇到大时延时所进行的不必要重传会引起路由器利用其链路带宽来转发不必要的分组副本

          <img src="./3运输层/image-20240610202013351.png" alt="image-20240610202013351" style="zoom:67%;" />

     3. 情况3：4 个发送方和具有有限缓存的多台路由器及多跳路径

        - 对于较小的 $\lambda_{in}$， $\lambda_{in}$ 的增大会导致 $\lambda_{out}$ 的增大

        - 当 $\lambda_{in}$ 较大时，在重载的极限情况下， A-C 端到端吞吐量将趋近于0

          <img src="./3运输层/image-20240610202614886.png" alt="image-20240610202614886" style="zoom:67%;" />
     
        - 代价3：当一个分组沿一条路径被丢弃时，每个上游路由器用于转发该分组到丢弃该分组而使用的传输容量最终被浪费掉了
     
   - 拥塞控制方法
   
     - 端到端拥塞控制：
   
       - 网络层没有为运输层拥塞控制提供显式支持
       - 端系统根据延迟和丢失事件推断是否有拥塞
       - TCP采用的方法：减小其窗口长度
     2. 网络辅助的拥塞控制：
   
        - 路由器向发送方提供关于网络中拥塞状态的显式反馈信息
   
        - 简单地用一个比特来指示链路中的拥塞情况
   
        - 显式地通知发送方它（路由器）能在输出链路上支持的最大主机发送速率

## TCP 的 3 次握手

1. 第一步： 客户端的 TCP 首先向服务器端的 TCP 发送一个特殊的 TCP 报文段。该报文段中不包含应用层数据。但是在报文段的首部中的一个标志位
   （即 SYN 比特）被置为1 。因此，这个特殊报文段被称为 SYN 报文段。另外，客户会随机地选择一个初始序号（clienl_isn），并将此编号放置于该起始的 TCP SYN 报文段的序号字段中。该报文段会被封装在一个 IP 数据报中，并发送给服务器。
2. 第二步： 一旦包含 TCP SYN 报文段的 IP 数据报到达服务器主机，服务器会从该数据报中提取出 TCP SYN 报文段，为该 TCP 连接分配 TCP 缓存和变扯， 并向该客户 TCP 发送允许连接的报文段。这个允许连接的报文段也不包含应用层数据。但是，在报文段的首部却包含 3 个重要的信息。首先，SYN 比特被置为 1 。其次，该 TCP 报文段首部的确认号字段被置为 clienl_isn + 1 。最后，服务器选择自己的初始序号（server_isn），并将其放置到 TCP 报文段首部的序号字段中。该允许连接的报文段被称为 **SYNACK 报文段**
3. 第三步：在收到 SYNACK 报文段后，客户也要给该连接分配缓存和变量。客户主机则向服务器发送另外一个报文段，这最后一个报文段对服务器允许连接的报文段进行了确认（该客户通过将值 server_isn + 1 放置到 TCP 报文段首部的确认字段中来完成此项工作）。因为连接已经建立了，所以该 SYN 比特被置为0 。该三次握手的第三个阶段可以在报文段负载中携带客户到服务器的数据。

## TCP拥塞控制方法：慢启动、拥塞避免、快速恢复

让每一个发送方根据所感知到的网络拥塞程度来限制其能向连接发送流量的速率

1. TCP 发送方是如何限制向其连接发送流量？

   - 运行在发送方的 TCP 拥塞控制机制跟踪一个额外的变量，即**拥塞窗口 cwnd**，它对一个 TCP 发送方能向网络中发送流量的速率进行了限制，$\text{LastByteSent}-\text{LastByteAcked} \leq min\{\text{cwnd}, \text{rwnd}\}$

   - 发送速率 = cwnd / RTT 字节／秒。通过调节 cwnd 的值，发送方因此能调整它向连接发送数据的速率。

2. TCP 发送方如何感知在它与目的地之间的路径上出现了拥塞？

   - 超时 / 收到来自接收方的3个冗余ACK

3. TCP 发送方怎样确定它应当发送的速率？
   - 一个丢失的报文段表意味着拥塞，因此当丢失报文段时应当降低 TCP 发送方的速率
   - 一个确认报文段指示该网络正在向接收方交付发送方的报文段，因此，当对先前未确认报文段的确认到达时，能够增加发送方的速率
   - 带宽探测

**1、慢启动**

1. 在慢启动状态， cwnd 的值以1 个 MSS 开始并且每当传输的报文段首次被确认就增加 1 个 MSS
   - 原因：cwnd 的值通常初始置为一个 MSS 的较小值，使得初始发送速率大约为 MSS / RTT 
   - 可用带宽可能比 MSS / RTT 大得多，TCP 发送方希望迅速找到可用带宽的数量

2. 结束慢启动
   - 如果存在一个由超时指示的丢包事件（即拥塞），TCP 发送方将 cwnd 设置为 1 并重新开始慢启动过程。并将第二个状态变量的值 ssthresh（慢启动阈值）设置为 cwnd / 2
   - 当 cwnd 的值等于 ssthresh 时，结束慢启动并且 TCP 转移到拥塞避免模式
   - 如果检测到 3 个冗余 ACK, 这时 TCP 执行一种快速重传并进入快速恢复状态

**2、拥塞避免**

1. 一且进入拥塞避免状态， cwnd 的值大约是上次遇到拥塞时的值的一半。因此，TCP 无法每过一个 RTT 再将 cwnd 的值翻番，每个 RTT 只将 cwnd 的值增加一个 MSS
   - 对于TCP 发送方无论何时到达一个新的确认，就将 cwnd 增加一个
     MSS（MSS / cwnd）字节
   - 何时应当结束拥塞避免的线性增长：
     - 收到 3 个冗余 ACK 时，TCP 将cwnd 的值减半，将ssthresh 的值记录为 cwnd 的值的一半
     - 超时，cwnd 的值被设置为 1 个 MSS

**3、快速恢复**

在快速恢复中，对于引起 TCP 进入快速恢复状态的缺失报文段，每当收到冗余的 ACK 、cwnd 的值增加一个 MSS。最终，当对丢失报文段的一个 ACK 到达时， TCP 在降低 cwnd 后进入拥塞避免状态。

- 超时：快速恢复在执行如同在慢启动和拥塞避免中相同的操作后，迁移到慢启动状态
- 丢包：cwnd 的值被设置为 1 个 MSS，且 ssthresh 的值设置为 cwnd 值的一半

**加性增、乘性减**（AIMD）

总结：

<img src="./期末复习/image-20240610211507577.png" alt="image-20240610211507577" style="zoom:67%;" />

# 4 网络层：数据平面

## 数据平面、控制平面的主要作用 + 转发、路由选择

1. **数据平面、控制平面的主要作用**
   - 数据平面：从其输入链路向其输出链路转发数据报
   - 控制平面：协调本地的路由器转发操作，使得数据报沿着源和目的地主机之间的路由器路径最终进行端到端传送
2. **转发**：
   - 当一个分组到达某路由器的一条输入链路时，该路由器必须将该分组移动到适当的输出链路
   - 将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地操作
   - 在数据平面中实现的唯一功能
   - 用硬件来实现

3. **路由选择**
   - 当分组从发送方流向接收方时，网络层必须决定这些分组所采用的路由或路径。计算这些路径的算法被称为**路由选择算法**
   - 确定分组从源到目的地所采取的端到端路径的网络范围处理过程
   - 用软件来实现

## 路由器的4个组件

1. **输入端口**：
   - 执行终结入物理链路的物理层功能
   - 与位于入链路远端的数据链路层交互操作来执行数据链路层功能
   - 执行查找功能，通过查询转发表决定路巾器的输出端口，到达的分组通过路由器的交换结构转发到输出端口
- **交换结构**：将路由器的输入端口连接到它的输出端口
- **输出端口**：存储从交换结构接收的分组，并通过执行必要的链路层和物理层功能在输出链路上传输这些分组
- **路由选择处理器**：执行控制平面功能
  - 传统的路由器：执行路由选择协议，维护路由选择表与关联链路状态信息，并为该路由器计算转发表
  - SDN 路由器：负责与远程控制器通信，目的是接收由远程控制器计算的转发表项，并在该
    路由器的输入端口安装这些表项
  - 执行网络管理功能

## 路由器中的最长前缀匹配规则

当给定目标地址查找转发表时，采用最长地址前缀匹配的目标地址表项

## 三种交换技术

1. **经内存交换**
   - 在 CPU 的直接控制下完成
   - 分组从输入端口处被复制到处理器内存中
   - 路由选择处理器从其首部提取目的地址，在转发表中查找适当的输出端口，并将该分组复制到输出端口的缓存中
   - 如果内存带宽为每秒可写进内存或从内存读出最多 B 个分组，则总的转发吞吐量（分组
     从输入端口被传送到输出端口的总速率）必然小于 B/2
   - 一次只能转发一个分组

2. **经总线交换**
   - 输入端口经一根共享总线将分组直接传送到输出端口，不需要路由选择处理器的干预
   - 让输入端口为分组预先计划一个交换机内部标签（首部），指示本地输出端口，使分组在总线上传送和传输到输出端口
   - 该分组能由所有输出端口收到，但只有与该标签匹配的端口才能保存该分组
   - 然后标签在输出端口被去除，因为其仅用于交换机内部来跨越总线
   - 如果多个分组同时到达路由器，每个位于不同的输出端口，除了一个分组外所有其他分组必须等待，因为一次只有一个分组能够跨越总线
   - **总线竞争**：因为每个分组必须跨过单一总线，故路由器的交换带宽受总线速率的限制
   - 一次处理一个分组

3. **经互联网络交换**

   - 纵横式交换机是由 2N 条总线组成的互联网络，它连接 N 个输入端口与 N 个输出端口
     - 交叉点通过交换结构控制器能够在任何时候开启和闭合
     - 当某分组到达端口 A，需要转发到端口 Y 时，交换机控制器闭合总线 A 和 Y 交叉部位的交叉点，然后端口 A 在其总线上发送该分组，该分组仅由总线 Y 接收

   - 纵横式网络能够并行转发多个分组
   - 纵横式交换机是非阻塞的，即只要没有其他分组当前被转发到该输出端口，转发到输出端口的分组就不会被到达输出端口的分组阻塞
   - 如果来自两个不同输入端口的两个分组的目的地为相同的输出端口，则一个分组必须在输入端等待，因为在某个时刻经给定总线仅能够发送一个分组
   - 高级设计：多级交换元素，以使来自不同输入端口的分组通过交换结构同时朝着相同的输出端口前行

## 分组调度：先进先出、优先权排队、循环和加权公平排队

1. **先进先出（FIFO）**：按照分组到达输出链路队列的相同次序来选择分组在链路上传输

2. **优先权排队**：到达输出链路的分组被分类放入输出队列中的优先权类

   - 每个优先权类通常都有自己的队列
   - 当选择一个分组传输时，优先权排队规则将从队列为非空的最高优先权类中选择传输一个分组
   - 在同一优先权类的分组之间的选择通常以 FlFO 方式完成

3. **循环和加权公平排队**

   1. 循环排队规则：
      - 分类，但不存在严格的服务优先权
      - 循环调度器在这些类之间轮流提供服务
      - **保持工作排队**规则：在有（任何类的）分组排队等待传输时，不允许链路保持空闲。当寻找给定类的分组但是没有找到时，保持工作的循环规则将立即检查循环序列中的下一个类

   2. **加权公平排队（WFQ）**：
      - 类似循环调度，使用保持工作排队规则
      - 每个类 $i$ 被分配一个权 $w_i$，在类 $i$ 有分组要发送的任何时间间隔中，类 $i$ 将确保接收到的服务部分等于 $w_i / (\sum w_j)$​，式中分母中的和是通过计算所有有分组排队等待传输的类别得到的
      - 对于一条传输速率为 R 的链路，类 $i$ 能获得至少为 $R \cdot w_i / (\sum w_j)$ 的吞吐量

## IPv4 编址：二进制 / 十进制 IP 地址、子网、无类别域间路由选择

1. IP 地址：32 比特，按**点分十进制记法**，如 193.32.216.9

2. 接口：主机 / 路由器和物理链路的连接处

3. 一个 IP 地址和一个接口相关联

4. **子网**：
   - 一个子网内的节点（主机或者路由器）它们的 IP 地址的高位部分相同，这些节点构成的网络的一部分叫做**子网**
   - IP 编址：子网部分（高位） + 主机部分，如 223.1.1.0/24，/24 称为**子网掩码**
   - 无需路由器介入，子网内各主机可以在物理上相互直接到达
   - 为了确定子网，分开主机和路由器的每个接口，产生几个隔离的网络岛，使用接口端接这些隔离的网络的端点。这些隔离的网络中的每一个都叫作一个子网

5. **无类别域间路由选择（CIDR）**：当使用子网寻址时， 32 比特的 IP 地址被划分为两部分，并且也具有点分十进制数形式 a. b. c. d/x，其中 x 指示了地址的第一部分中的比特数

   - 形式为 a. b. c. d/x 的地址的 x 最高比特构成了 IP 地址的网络部分，并且经常被称为该地址的**前缀** / **网络前缀**

   - 一个地址的剩余 32-x 比特可认为是用于区分该组织内部设备的，其中的所有设备具有相同的网络前缀

## 动态主机配置协议的工作原理

- 允许主机自动获取一个 IP 地址

- 可以使主机每次与网络连接时能得到一个相同的 IP 地址，或者某主机将被分配一个**临时的 IP 地址**。每次与网络连接时该地址也许是不同的

- 允许一台主机得知其他信息，例如它的子网掩码、它的第一跳路由器地址（常称为默认网关）
  与它的本地 DNS 服务器的地址

- 客户-服务器协议

  <img src="./期末复习/image-20240611221642730.png" alt="image-20240611221642730" style="zoom: 50%;" />

- 4个过程：

  - **DHCP 服务器发现**。主机使用 **DHCP 发现报文**发现一个要与其交互的 DHCP 服务器。

    DHCP 客户生成包含 DHCP 发现报文的 IP 数据报，其中使用广播目的地址255.255.255.255 并且使用“本主机”源 IP 地址 0.0.0.0。DHCP 客户将该 IP 数据报传递给链路层、链路层然后将该帧广播到所有与该子网连接的节点

  - **DHCP 服务器提供**。DHCP 服务器收到一个 DHCP 发现报文时，用 **DHCP 提供报文**向客户做出响应，该报文向该子网的所有节点广播，仍然使用 255.255.255.255

    每台服务器提供的报文包含收到的发现报文的事务 ID 、向客户推荐的 IP 地址、网络掩码以及 **IP 地址租用期**

  - **DHCP 请求**。新到达的客户从一个或多个服务器提供中选择一个，并向选中的服务器提供用 **DHCP 请求报文**进行响应，回显配置的参数

  - **DHCP ACK**。服务器用 **DHCP ACK 报文**对 DHCP 请求报文进行响应，证实所要求的参数

## 网络地址转换的工作原理

- 动机：本地网络只有一个有效IP地址
  - 不需要从 ISP 分配一块地址，可用一个IP地址用于所有的（局域网）设备——省钱
  - 可以在局域网改变设备的地址情况下而无须通知外界
  - 可以改变ISP（地址变化）而不需要改变内部的设备地址
  - 局域网内部的设备没有明确的地址，对外是不可见的——安全

- 外出数据包：替换源地址和端口号为 NAT IP 地址和新的端口号，目标 IP 和端口不变
- 使用 **NAT 转换表**：记住每个转换替换对
- 进入数据包：从 NAT 转换表中检索出家庭网络浏览器使用的适当 IP 地址和目的端口号，替换目标 IP 地址和端口号

## IPv4向IPv6迁移中采用的建隧道方法

- 假定两个IPv6 节点要使用 IPv6 数据报进行交互，但它们是经由中间 IPv4 路由器互联的。我们将两台 IPv6 路由器之间的中间 IPv4 路由器的集合称为一个**隧道**
- 借助于隧道，在隧道发送端的 IPv6 节点可将整个 IPv6 数据报放到一个 IPv4 数据报的数据（有效载荷）字段中。于是，该 IPv4 数据报的地址设为指向隧道接收端的 IPv6 节点再发送给隧道中的第一个节点
- 隧道中的中间 IPv4 路由器在它们之间为该数据报提供路由，就像对待其他数据报一样，完全不知道该 IPv4 数据报本身就含有一个完整的 IPv6 数据报
- 隧道接收端的 IPv6 节点最终收到该IPv4 数据报（它是该IPv4 数据报的目的地），并确定该 IPv4 数据报含有一个 IPv6 数据报（通过观察在IPv4 数据报中的协议号字段是41，指示该 IPv4 有效载荷是IPv6 数据报），从中取出 IPv6 数据报，然后再为该 IPv6 数据报提供路由，就好像它是从一个直接相连的 IPv6 邻居那里接收到该 IPv6 数据报一样

![image-20240611224617122](./期末复习/image-20240611224617122.png)

# 5 网络层：控制平面

## 每路由器控制、逻辑集中式控制

- **每路由器控制**（传统）：每台路由器有一个路由选择组件，计算转发表的值
- **逻辑集中式控制（SDN）**：一个不同的（远程的）控制器与每台路由器中的一个控制代理（CA）交互，配置和管理转发表
  - CA 功能少，按控制器命令行事

## 链路状态算法的工作原理

1. 让每个节点向网络中所有其他节点广播链路状态分组，其中每个链路状态分组包含它所连接的链路的标识和开销（**链路状态广播算法**）

2. Dijkstra 算法：迭代算法

   - $D(v)$：到算法的本次迭代，从源节点到目的节点 v 的最低开销路径的开销
   - $p(v)$：从源到 v 沿着当前最低开销路径的前一节点（v 的邻居）

   - $N'$：节点子集；如果从源到 v 的最低开销路径已确知，v 在 $N'$ 中

3. 源节点 u 的链路状态（LS）算法

   ![image-20240612185701208](./期末复习/image-20240612185701208.png)

4. 复杂度：所有迭代中需要搜寻的节点总数为 $n(n+1)/2$，最差情况下复杂度为 $O(n^2)$
5. 振荡

## 距离向量算法的工作原理

1. 迭代的、异步的和分布式的算法
2. Bellman-Ford 方程：$d_x(y) = \min_v \{ c(x,y)+d_v(y) \}$
   - $d_x(y)$​ 是从节点 x 到节点 y 的最低开销路径的开销
   - $\min_v$ 是对于 x 的所有邻居
3. 每个节点 x 以 $D_x(y)$ 开始，对在 N 中的所有节点 y，估计从 x 到 y 的最低开销路径的开销。令 $D_x(y) = [D_x(y):y \in N]$ 是节点 x 的距离向量，该向量是从 x 到 N 中的所有其他节点 y 的开销估计向量。每个节点 x 维护下列路由选择信息：
   - 对于每个邻居 v，从 x 到直接相连邻居 v 的开销为 $c(x,y)$
   - 节点 x 的距离向量，即 $D_x(y) = [D_x(y):y \in N]$，包含了从 x 到 N 中的所有目的地 y 的开销估计值
   - 它的每个邻居的距离向量，即对 x 的每个邻居 v，$D_v = [D_V(y):y \in N]$
   - 当节点 x 从它的任何一个邻居 w 接收到一个新的距离向量，它保存 w 的距离向量，然后使用 Bellman-Ford 方程更新它自己的距离向量
   - 如果节点 x 的距离向量因这个更新步骤而改变，节点 x 接下来将向它的每个邻居发送其更新后的距离向量，这继而让所有邻居更新它们自己的距离向量

## 什么是OSPF

1. **自治系统（AS）**解决的问题：
   - 规模：减少大型网络中的路由计算的复杂性
   - 管理自治：ISP
2. 自治系统内部路由选择协议：在一个自治系统内运行的路由选择算法
3. **开放最短路优先（OSPF）**：用于 AS 内部路由选择
   - 路由选择协议规范是公众可用的（open）
   - 链路状态协议，使用洪泛链路状态信息和 Dijkstra 最低开销路径算法
     - 一台路由器构建了一幅关于整个自治系统的完整拓扑图，在本地运行 Dijkstra 算法，以确定一个以自身为根节点到所有子网的最短路径树
   - 路由器向自治系统内所有其他路由器广播路由选择信息。每当一条链路的状态发生变化时，路由器就会广播链路状态信息。未发生变化，也要周期性地广播链路状态
   - OSPF 通告：包含在 OSPF 报文中，直接由 IP 承载
   - 优点：
     - 安全。能够鉴别 OSPF 路由器之间的交换，防止恶意入侵者将不正确的信息注入路由器表内
     - 多条相同开销的路径。当存在多条相等开销的路径时，OSPF 允许使用多条路径
     - 对单播与多播路由选择的综合支持
     - 支持在单个 AS 中的层次结构。能层次化地配置多个区域，每个区域都运行自己的 OSPF 链路状态路由选择算法

## 边界网关协议BGP的工作原理

1. 背景：分组跨越多个 AS 进行路由，需要**自治系统间路由选择协议**：**边界网关协议（BGP）**

2. 作用：
   1. 在 BGP 中，分组是路由到 CIDR 化的前缀，其中每个前缀表示一个子网或一个子网的集合
   2. 一台路由器的转发表将具有形式为 $(x,I)$ 的表项，其中 x 是一个前缀（例如 13.8.16. 68/22），I 是该路由器的接口之一的接口号
   3. BGP 提供给每台路由器完成以下任务的手段：
      - 从邻居 AS 获得前缀的可达性信息
      - 确定到该前缀的“最好的“路由

3. **BGP 路径通告**

   1. **网关路由器**：位于 AS 边缘的路由器，直接连接到在其他 AS 中的一台或多台路由器

      **内部路由器**：仅连接在它自己 AS 中的主机和路由器

   2. 如何向所有路由器通过对于前缀 x 的可达性信息

      - 通过路由器，使用 179 端口的半永久 TCP 连接。每条直接连接以及所有通过该连接发送的BGP 报文，称为 **BGP 连接**
      - 跨越两个 AS 的 BGP 连接称为**外部 BGP（eBGP）**连接
        在相同 AS 中的两台路由器之间的 BGP 会话称为**内部 BGP（iBGP）**连接

4. **确定最好的路由**

   - 路由器通过 BGP 连接通告前缀时，前缀中包括 **BGP 属性**，前缀及其属性称为**路由**（route）
   - 两个重要的属性：AS-PATH、NEXT-HOP

     - AS-PATH：包含通告已经通过的 AS 的列表。为了生成  AS-PATH 值，当一个前缀通过某 AS 时，该 AS 将其 ASN 加入 AS -PATH 中的现有列表。检测和防止通告环路。如果一台路由器在路径列表中看到包含了它自己的 AS，它将拒绝该通告

     - NEXT-HOP：AS-PATH 起始的路由器接口的 lP 地址 

   - 每条 BGP 路由包含3个组件：NEXT-HOP；ASPATH；目的地前缀

   1. 热土豆路由选择（BCP 路由选择算法）：（从所有可能的路由中）选择的路由到开始该路由 NEXT-HOP 路由器具有最小开销

   ![image-20240612212720038](./5网络层：控制平面/image-20240612212720038.png)

   热土豆路由选择试图减小在它自己 AS 中的开销，而忽略在其 AS 之外的端到端开销的其他部分 

   2. 路由器选择算法
      - 路由被指派一个**本地偏好**值作为其属性之一
      - 从余下的路由中（所有都具有相同的最高本地偏好值），选择具有最短 AS-PATH 的路由
      - 从余下的路由中（所有都具有相同的最高本地偏好值和相同的 AS-PATH 长度），使用热土豆路由选择，即选择具有最靠近 NEXT-HOP 路由器的路由
      - 如果仍留下多条路由，该路由器使用 BGP 标识符来选择路由

4. **路由选择策略**

   ![image-20240612213518497](./期末复习/image-20240612213518497.png)

   - ABC：主干提供商网络，WXY：接入 ISP
   - X：**多宿接入 ISP**、**桩网络**：进入 / 离开 ISP 的所有流量的源 /目的地

   - 策略强制让X：
     - X不想路由从B通过X到C的分组
     - 因而X就不通告给B，它实际上可以路由到C

## SDN体系结构的4个关键特征

- **基于流的转发**：SDN 控制的交换机的分组转发工作，能够基于运输层、网络层或链路层首部中任意数扯的首部字段值进行
- **数据平面与控制平面分离**：数据平面由网络交换机组成，控制平面由服务器以及决定和管理交换机流表的软件组成
- **网络控制功能**：位于数据平面交换机外部。软件在服务器上执行
  - 控制平面自身由两个组件组成：一个 SDN 控制器 + 若干网络控制应用程序
    - 控制器维护准确的网络状态信息；为运行在控制平面中的网络控制应用程序提供这些信息；提供方法，这些应用程序通过这些方法能够监视、编程和控制下面的网络设备
    - SDN 控制器：
      - 通信层：SDN 控制器和受控网络设备之间的通信。OpenFlow 协议
        - OpenFlow 协议
          - 从控制器流向受控交换机的重要报文如下：

            - 配置：允许控制器查询并设置交换机的配置参数
            - 修改状态：由控制器所使用，以增加／删除或修改交换机流表中的表项，并且设置交换机端口特性
            - 读状态：该报文被控制器用于从交换机的流表和端口收集统计数据和计数器值
            - 发送分组：该报文被控制器用于在受控交换机从特定的端口发送出一个特定的报文

          - 从受控交换机流向控制器的重要报文如下：
            - 流删除：该报文通知控制器已删除一个流表项
            - 端口状态：向控制器通知端口状态的变化
            - 分组入：一个分组到达交换机端口 ，并且不能与任何流表项匹配，那么这个分组将被发送给控制器进行额外处理 匹配的分组也可能发送给控制器，作为匹配时所采取的一个操作分组入报文被用于向控制器发送这样的分组
      - 网络范围状态管理层。控制器具有有关网络的主机、链路、交换机和其他SDN 控制设备的最新状态信息
      - 对于网络控制应用程序层的接口。通过它的“北向“接口与网络控制应用程序交互。该 API 允许网络控制应用程序在状态管理层之间读写网络状态和流表
- **可编程的网络**：使用由 SDN 控制器提供的 API 来定义和控制网络设备中的数据平面

## 什么是ICMP

1. 被主机和路由器用来彼此沟通网络层的信息
   - 差错报告
   - Echo 请求和回复（ping）
2. lCMP 处在网络层，但体系结构位于 IP 之上：ICMP 报文由 IP 分组承载
3. ICMP 报文有一个类型字段和一个编码字段，并且包含引起该 lCMP 报文首次生成的 IP 数据报的首部和前 8 字节（以便发送方能确定引发该差错的数据报）

<img src="./期末复习/image-20240612215652933.png" alt="image-20240612215652933" style="zoom: 67%;" />

4. ping 程序发送一个 ICMP 类型 8 编码 0 的报文到指定主机。看到回显请求，目的主机发回一个类型 0 编码 0 的 ICMP 回显回答
5. 源抑制报文：执行拥塞控制

<img src="./期末复习/image-20240612215910872.png" alt="image-20240612215910872" style="zoom:67%;" />

## 网络管理的关键组件

网络管理的关键组件：

- 管理服务器。应用程序，运行在网络运营中心（NOC），需要**网络管理员**
  - 执行网络管理活动
  - 控制网络管理信息与命令的收集、处理、分析和／或显示 
  - 发起配置、监视和控制网络的被管设备的操作
- 被管设备。驻留在被管网络上的某种网络设备（主机、路由器、交换机、中间盒、调制解调器、温度计等）。本身将有许多可管理的组件，以及这些硬件和软件组件的配置参数
- 数据（状态）：与被关设备关联
  - 配置数据：由网络管理员显式配置的设备信息（分配 / 配置的 IP 地址或接口速率）
  - 运行数据：指设备在运行过程中获取的信息（OSPF 协议中的直接邻居列表）
  - 设备统计：设备操作员更新的状态指示器和计数（接口上丢弃分组的数量 或设备的冷却风扇速度）
  - 查询远程设备数据、写入设备数据来控制、维护数据副本
- 网络管理代理：运行在被管设备上的软件进程，与管理服务器通信，在管理服务器的命令和控制下在被管设备上执行本地操作
- 网络管理协议：运行在管理服务器和被管设备之间。允许管理服务器查询被管设备的状态，并经过其代理间接地在这些设备上执行操作。代理能够使用网络管理协议向管理服务器通知异常事件（如组件故障或超过了性能阈值）

运营商商通常采用 3 种方式来管理网络，涉及组件如下：

- 命令行接口（CLI）
- SNMP / MIB。通过简单网络管理协议（SNMP）查询／设置设备的管理信息库（MIB）
- NETCONF / YANG

## 什么是SNMP

- 应用层协议，用于在管理服务器和代表管理服务器执行的代理之间传递网络管理控制和信息报文
- 功能：
  - 请求响应模式，请求通常用于查询（检索）或修改（设置）与某被管设备关联的 MIB 对象值
  - 代理向管理服务器发送的一种非请求报文——**陷阱报文**，通知管理服务器一个异常情况导致了 MIB 对象值的改变

![image-20240612221535059](./期末复习/image-20240612221535059.png)

- 报文功能：
  - GetRequest、GetNextRequest 和 GetBulkRequest PDU：请求位于该代理所在的被管设备中的一个或多个 MIB 对象值
  - 管理服务器使用 SetRequest PDU 来设置位于被管设备中的一个或多个 MIB 对象的值
  - 管理服务器使用 InformRequest PDU 来通知另一个 MIB 信息管理服务器
  - Response PDU 响应来自该服务器的请求报文，返回所请求的信息
  - 陷阱报文

# 6 链路层和局域网

## 什么是节点、链路

1. **节点**：运行链路层协议协议的任何设备，包括主机、路由器、交换机和 WiFi 接入点
2. **链路**：沿着通信路径连接相邻节点的通信信道。在通过给定的链路时，传输节点将数据报封装在链路层帧中，并将该帧传送到链路中

## 链路层提供的可能服务包括？链路层在何处实现

- **链路层提供的服务**

  1. **成帧**：在每个网络层数据报经链路传送之前，几乎所有的链路层协议都要将其用**链路层帧**封装起来
     - 一个帧由一个数据字段和若干首部字段组成，其中网络层数据报就插在数据字段中
     - 帧的结构由链路层协议规定

  2. **链路接入**：**介质访问控制（MAC）协议**规定了帧在链路上传输的规则
     - 在链路的一端仅有一个发送方、链路的另一端仅有一个接收方的点对点链路， MAC 协议比较简单（或者不存在），即无论何时链路空闲，发送方都能够发送帧
     - 多路访问问题：MAC 协议协凋多个节点的帧传输

  3. **可靠交付**：保证无差错地经链路层移动每个网络层数据报。
     - 通过确认和重传取得
     - 用于易于产生高差错率的链路，本地纠正差错
     - 对于低比特差错的链路，链路层可靠交付可能会被认为是一种不必要的开销

  4. **差错桧测和纠正**
     - 信号衰减和电磁噪声 → 比特差错
     - 用硬件实现

- **链路层在何处实现**

  1. 在大多数情况下，链路层是在称为**网络适配器**的芯片上实现的，有时也称为**网络接口控制器（NIC）**。网络适配器实现了许多链路层服务，包括成帧、链路访问、错误检测等。因此，**链路层控制器**的大部分功能是在硬件中实现的
  2. 在发送端，控制器取得由协议栈较高层生成并存储在主机内存中的数据报，在链路层帧中封装该数据报（填写该帧的各个字段），然后遵循链路接入协议将该帧传进通信链路中。在接收端，控制器接收了整个帧，抽取出网络层数据报。如果链路层执行差错检测，则需要发送控制器在该帧的首部设置差错检测比特，由接收控制器执行差错检测。
  3. 部分链路层是在运行于主机 CPU 上的软件中实现的。软件组件实现里高层链路层功能，如组装链路层寻址信息和激活控制器硬件。在接收端，链路层软件响应控制器中断（例如，由于一个或多个帧的到达），处理差错条件和将数据报向上传递给网络层。

## 奇偶校验、检验和、循环冗余检测的基本原理

1. **奇偶校验**

   1. **单个奇偶校验位**：发送的信息 D 有 d 比特，发送方只需包含一个附加的比特，使得这 d+1 比特中 1 的总数是偶数。接收方能检测出**奇数**个比特差错，出现偶数个比特差错则需要二维化一般方案

   1. **二维奇偶校验**：将 d 比特划分为 i 行 j 列，对每行和每列计算奇偶值，产生的 i+j+1 奇偶比特就构成了链路层帧的差错检测比特。单个比特差错可检测可纠正，二维奇偶校验能检测不能纠正

      <img src="./期末复习/image-20240613152625764.png" alt="image-20240613152625764" style="zoom: 80%;" align="left"/>

2. **检验和**

   - 将 d 比特数据转换为 k 比特整数的，并将 k 比特整数加起来，并用得到的和作为差错检测比特
   2. 接收方通过对接收的数据（包括检验和）的和取反码，并且检测其结果是否为全 1 比特来检测检验和。如果这些比特中有任何比特是0，就可以指示出差错

3. **循环冗余检测（CRC）**

   - 生成多项式：对于 d 比特数据 D，发送方和接收方协商一个 r + 1 比特模式，表示为 G。G 的最高位（最左边）是 1

     <img src="./期末复习/image-20240613153904449.png" alt="image-20240613153904449" align="left"/>

   - 数据 D 附加是 r 个附加比特 R，得到的 d + r 比特模式用模 2 算术恰好能被 G 整除。接收方用 G 除后余数非 - 则出现差错。

   - $R = \text{remainder} \frac{D \cdot 2^r}{G}$

     <img src="./期末复习/image-20240613154239877.png" alt="image-20240613154239877" align="left"/>

## 多路访问协议分为哪三种类型？每种类型的工作原理

1. **信道划分协议**
   1. **时分多路复用（TDM）**
      - 将时间划分为时间帧，进一步划分每个时间帧为 N 个时隙，把每个时隙分配给 N 个节点中的一个
      - 优点：消除了碰撞且公平；信道的传输速率为 R，每个节点在每个帧时间内得到了专用的传输速率 R/N bps
      - 缺点：节点被限制于 R/N bps 的平均速率；节点必须等待轮次

   2. **频分多路复用（FDM）**
      - 将 R bps 信道划分为不同的频段（每个频段具有 R/N 带宽），并把每个频率分配给 N 个节点中的一个
      - 优点：消除了碰撞且公平
      - 缺点：限制一个节点只能使用 R/N 的带宽

   3. **码分多址（CDMA）**
      - 对每个节点分配一种不同的**编码**，每个节点用它唯一的编码来对它发送的数据进行编码
      - 能使不同的节点同时传输

2. **随机接入协议**：一个传输节点总是以信道的全部速率进行发送。当有碰撞时，涉及碰撞的每个节点反复地重发它的帧（也就是分组），到该帧无碰撞地通过为止。但是当一个节点经历一次碰撞时，它不必立刻重发该帧。相反，它在重发该帧之前等待一个随机时延。涉及碰撞的每个节点独立地选择随机时延。

3. **轮流协议**

   1. **轮询协议**：节点中某节点被指定为主节点。主节点以循环的方**轮询**每个节点，告诉每个节点能传输的帧的最多数量。
      - 优点：消除了困扰随机接入协议的碰撞和空时隙，效率更高
      - 缺点：轮询时延；主节点有故障，整个信道都变得不可操作

   2. **令牌传递协议**：一个称为**令牌**（token）的小的特殊帧在节点之间以某种固定的次序进行交换。当一个节点收到令牌时，仅当它有一些帧要发送时，它才持有这个令牌；否则，它立即向下一个节点转发该令牌。当一个节点收到令牌时，如果它确实有帧要传输，它发送最大数目的帧数，然后把令牌转发给下一个节点。
      - 优点：分散，效率高
      - 缺点：一个节点鼓掌可能使整个信道崩溃；一个节点忘记了释放令牌，则必须调用某些恢复步骤使令牌返回到循环中来

## 什么是CSMA？什么是CSMA/CD？它们的工作原理和区别是什么

1. **载波侦听**：一个节点在传输前先听信道，如果来自另一个节点的帧正向信道上发送，节点则等待直到检测到一小段时间没有传输，然后开始传输——载波侦听多路访问（**CSMA**）
2. **碰撞检测**：当一个传输节点在传输时一直在侦听此信道。如果它检测到另一个节点正在传输干扰帧，它就停止传输，在重复＂侦听－ 当空闲时传输＂循环之前等待一段随机时间——具有碰撞检测的 CSMA（**CSMA/CD**）

3. 广播信道的端到端**信道传播时延**导致即使有载波侦听也会发生碰撞

4. 从与广播信道相连的适配器的角度总结其运行

   （1）适配器从网络层一条获得数据报，准备链路层帧，并将其放入帧适配器缓存中
   （2）如果适配器侦听到信道空闲，开始传输帧。若侦听到信道正在忙，则等待
   （3）在传输过程中，适配器监视来自其他使用该广播信道的适配器的信号能量的存在
   （4）如果适配器传输整个帧而未检测到来自其他适配器的信号能扯，该适配器就完成了该帧。在另一方面，如果适配器在传输时检测到来自其他适配器的信号能量，它中止传输
   （5）中止传输后，适配器等待一个随机时间扯，然后返回步骤 2

5. 问题：选择随机回退时间的时间间隔多大为好 → 解决：**二进制指数后退**算法
   - 当传输一个给定帧时，在该帧经历了一连串的 n 次碰撞后，节点随机从 $\{0,1,2,...,2^n-1  \}$ 中选择一个 K 值，一个帧经历的碰撞越多， K 选择的间隔越大。对于以太网，一个节点等待的实际时间量是K 512 比特时间
6. CSMN/CD 效率

## MAC地址的表示方式

对于大多数局域网，MAC 地址长度为 6 字节，用十六进制表示法。共有 $2^{48}$ 个可能的 MAC 地址

## 地址解析协议的工作原理

**地址解析协议**：转换网络层地址和 MAC 地址

- ARP：在发送主机中的 ARP 模块将取在相同局域网上的任何 IP 地址作为输入，然后返回相应的 MAC 地址
- 每台主机或路由器在其内存中具有一个 ARP 表，包含 IP 地址到 MAC 地址的映射关系。也包含一个寿命（TTL）值，它指示了从表中删除每个映射的时间
- 若 ARP 表中当前没有该目的主机的表项，发送方用 ARP 协议来解析这个地址
  - 发送方构造一个称为 **ARP 查询分组**，向适配器传递且指示适配器应该用 MAC 广播地址来发送这个分组，包含该 ARP 查询的帧能被子网上的所有其他适配器接收到，并且每个适配器都把在该帧中的 ARP 分组向上传递给 ARP 模块。这些 ARP 模块中的每个都检查它的 IP 地址是否与 ARP 分组中的目的 IP 地址相匹配。与之匹配的一个给查询主机发送回一个带有所希望映射的响应ARP 分组。然后
    查询主机更新它的 ARP 表，并发送它的 IP 数据报，该数据报封装在一个链路层帧中，并且该帧的目的 MAC 就是对先前 ARP 请求进行响应的主机或路由器的 MAC 地址

## 交换机和路由器的区别

- 都是存储转发分组交换机，但是路由器是网络层的分组交换机，交换机是链路层的分组交换机
- 都有转发表：
  - 交换机：
    - 维护交换表，按照MAC地址转发
    - 执行过滤、自学习和生成树算法
    - 即插即用；二层设备，效率高
    - 执行生成树算法，限制广播帧的转发
    - ARP表项随着站点数量增多而增多
  - 路由器：
    - 维护路由表，执行路由算法
    - 路由算法能够避免环路，无需执行生成树算法，可以以各种拓扑构建网络
    - 对广播分组做限制
    - 不是即插即用，配置网络地址(子网前缀)
    - 三层设备，速率低

## 多协议标签交换技术

1. 多协议标签交换（MPLS）网络：分组交换的虚电路网络
2. **多协议标签交换（MPLS）**：改善 IP 路由器的转发速度，采用固定长度标签
   - 对于基于固定长度标签和虚电路的技术，在不放弃基于目的地 IP 数据报转发的基础设施的前提下，当可能时通过选择性地标识数据报并允许路由器基于固定长度的标签（而不是目的地 IP 地址）转发数据报来增强其功能
   - 一个 MPLS 加强的帧仅能在两个均为 MPLS 使能的路由器（**为标签交换路由器**）之间发送
   - 优点：
     - 新的流量管理能力：提供了沿着多条路由转发分组的能力（流量工程）
     - 能用于执行 MPLS 转发路径的快速恢复
     - 用于实现 VPN

## 数据中心网络的等级拓扑

<img src="./期末复习/image-20240613191806826.png" alt="image-20240613191806826" style="zoom: 67%;" align="left"/>

1. 数据中心中的主机称为**刀片**，在每一个机架顶部有一台交换机，这台交换机被称为**机架顶部（TOR）**交换机，机架上的每台主机都有一块与 TOR 交换机连接的网卡，每台 TOR 交换机有额外的端口能够与其他 TOR 交换机连接
2. **边界路由器**：处理外部客户与内部主机之间流动的流量
3. **负载均衡器**：向主机分发请求，以主机当前的负载作为函数来在主机之间均衡负载

4. **等级体系结构**



# 7 无线网络和移动网络

## 什么是无线主机、无线链路、基站？什么是基础设施模式、自组织网络？

1. **无线主机**：运行应用程序的端系统设备
2. **无线链路**：主机通过**无线通信链路**连接到一个基站或者到另一台无线主机。不同的无线链路技术具有不同的传输速率，能够传输不同的距离。无线链路标准的两种主要特性：链路速率和覆盖区域
3. **基站**：是无线网络基础设施中的一个关键部分，负责向与之关联的无线主机发送数据并从主机那里接收数据。基站通常负责协调与之相关联的多个无线主机的传输。（蜂窝塔、接入点）相关联指：主机位于基站的无线通信覆盖范围内；主机使用基站中继它和更大网络之间的数据
4. **基础设施模式**：与基站关联的主机以基础设施模式运行，因为所有传统的网络服务都由网络向通过基站相连的主机提供
5. **自组织网络**：在自组织网络中，无线主机没有这样的基础设施与之相连。在没有这样的基础设施的情况下，主机本身必须提供诸如路由选择、地址分配以及类似于 DNS 的名字转换等服务

## 什么是多径传播、信噪比？隐藏终端问题？

1. **多径传播**：电磁波的一部分受物体和地面反射，在发送方和接收方之间走了不同长度的路径。这使得接收方收到的信号变得模糊。发送方和接收方之间的移动物体可导致多路径传播随时间而改变

2. **信噪比（SNR）**：主机接收到一个电磁信号，而该信号是发送方传输的初始信号的退化形式和环境中的背景噪声的结合，其中的信号退化是由于衰减和我们前面讨论过的多径传播和其他一些因素所引起的。信噪比即收到的信号和噪声强度的相对测量，单位为分贝（dB）

5. **隐藏终端问题**：假设站点 A 正在向站点 B 传输，同时假定站点 C 向站点 B 传输，A 和 C 所处的位置使它们的信号强度不足以使它们相互检测到对方的传输，但它们的传输足以强到在站点 B 处互相干扰

   <img src="./7无线网络和移动网络/image-20240614094543003.png" alt="image-20240614094543003" style="zoom:67%;" align="left"/>

## CDMA的基本工作原理？

**CDMA**（码分多址）：属于信道划分协议族

1. 要发送的每个比特都通过乘以一个信号（编码）的比特来进行编码，这个信号的变化速率（**码片速率**）比初始数据比特序列速率快得多。设 $d_i$ 为 第 $i$ 个比特时隙中的数据比特值，把具有 0 比特值的数据比特表示为 -1，每个比特时隙细分为 M 个微时隙。发送方使用的 CDMA 编码由 M 个值的序列 $c_m$ 组成，$m=1,2,...,M$，每个取值为 +1 或 -1。

   - 对于 $d_i$ 比特传输时间的第 $m$ 个微时隙，CDMA 编码器的输出 $Z_{i,m}$ 是 $d_i$ 乘以分配的 CDMA 编码的第 m 个比特 $c_m$：$Z_{i,m} = d_i \cdot c_m$​
   - 在简单的情况下，对没有干扰的发送方，接收方将收到编码的比特 $Z_{i,m}$，并恢复初始的数据比特 $d_i$：$d_i = \frac{1}{M}\sum_{m=1}^M Z_{i,m} \cdot c_m$

   <img src="./期末复习/image-20240614100048769.png" alt="image-20240614100048769" style="zoom: 50%;" align="left"/>

## 被动扫描、主动扫描？

802.11 体系结构的基本构件模块是**基本服务集**（BSS），BSS 包含一个或多个无线站点以及一个被称为**接入点**的中央**基站**。每个无线站点在能够发送或者接受网络层数据之前，必须与一个AP相关联

当某网络管理员安装 AP 时，该管理员为该接入点分配一个单字或双字的**服务集标识符**（SSID）和一个**信道号**

**WiFi 丛林**是一个任意的物理位置，无线站点能从两个或多个 AP 中收到很强的信号。当进入 WiFi 丛林后，为了获得因特网接入，无线站点需要加入其中一个子网并需要与其中的一个 AP 相**关联**，即无线站点在自身和该 AP 之间创建一条虚拟线路，仅有关联的 AP 才向无线站点发送数据帧，并且无线站点也仅通过该关联 AP 向因特网发送数据帧。

无线站点如何得知哪个 AP 位于该丛林？

802.11 标准要求每个 AP 周期性地发送信标帧，每个信标帧包括该 AP 的 SSTD 和 MAC 地址，无线站点为了得知正在发送信标帧的 AP，扫描信道并监听信标帧，该过程称为**被动扫描**

**主动扫描**：无线主机通过向位于无线主机范围内的所有 AP 广播探测帧，AP 用一个探测响应帧确认该探测请求帧

## CSMA/CA的工作原理？

带碰撞避免的 CSMA，**CSMA/CA**：碰撞避免和链路层确认机制

1. **链路层确认**：处理无线局域网中某站点发送一个帧时，该帧会由于多种原因不能无损地到达目的站
   - 目的站点收到一个通过 CRC 校验的帧后，等待一个**短帧间间隔（SIFS）**，然后发回一个确认帧。如果发送站点在给定的时间内未收到确认帧，它假定出现了错误并重传该帧，使用 CSMA/CA 协议访问该信道。如果在若干固定次重传后仍未收到确认，传输站将放弃发送并丢弃该帧
2. 假设一个站点由一个帧要发送
   1. 如果某站点最初监听到信道空闲，它将在一个**分布式帧间间隔（DIFS）**后发送该帧
   2. 否则，该站点选取一个随机回退值并且在侦听到信道空闲时递减该值 当侦听到信道忙时，计数值保持不变
   3. 当计数值减为 0 时，该站点发送整个数据帧并等待确认
   4. 如果收到确认，传输站知道它的帧已被目的站正确接收了。如果该站点要发送另一帧，它将从第 2 步开始 CSMA/ CA 协议。如果未收到确认，传输站将重新进入第 2 步中的回退阶段，并从一个更大的范围内选取随机值
   5. 选择重新进入第二步，而不是直接进入 DIFS 是防止一直占用信道

## 4G LTE架构的部件？

4G 长期演化标准（**4G LTE**）

<img src="./期末复习/image-20240614103217368.png" alt="image-20240614103217368" style="zoom:67%;" align="left"/>

1. **移动设备**（用户设备 UE）：是一个网络端点，有一个 IP 地址和一个**国际移动用户身份（IMSI）**，存储在其 SIM 卡上
2. **基站**：管理无线电资源和其覆盖区域内的移动设备，协调无线电接入网中的设备认证和资源分配，创建从移动设备到网关的特定设备的 IP 隧道，并在它们之间进行交互，以处理小区之间的设备移动性 
3. **归属用户服务器（HSS）**。控制平面部件，是一个数据库，存储关于移动设备的信息
4. **服务网关（S-GW）**、**PDN 网关（PGW）**等其他网络路由器。
   - 服务网关和分组数据网络网关是位于移动设备与因特网之间的数据路径上的两台路由器
   - PDN 网关还为移动设备提供 NAT IP 地址，实现 NAT 功能
5. **移动性管理实体（MME）**：控制平面部件
   - **身份验证**：在收到来自移动设备的附加请求后，本地 MME 与移动设备归属网络中的 HSS 联系。然后，移动设备的归属 HSS 向本地 MME 返回足够的加密信息，以向移动设备证明归属 HSS 通过该 MME 执行真实性，并让移动设备向 MME 证明确实是与该 IMSI 关联的移动设备
   - **路径设置**：设置隧道且用于数据转发
   - **小区位置跟踪**：当设备在蜂窝小区间移动时，基站将更新设备位置的 MME

<img src="./期末复习/image-20240614140831093.png" alt="image-20240614140831093" style="zoom: 67%;" align="left"/>

## 到移动设备的间接路由？到移动设备的直接路由？

1. **到移动设备的间接路由**：通信者将数据报定位到移动设备的永久地址，并将数据报发送到网络中，不需要知道移动设备是在其归属网络中还是在被访网络中；因此，移动性对通信者来说是完全透明的
2. **到移动设备的直接路由**：
   - **三角路由选择问题**：即使在通信者与移动节点之间存在一条更有效的路由，发往移动节点的数据报也先要发给归属代理，然后再发送到外部网络
   - 通信者首先发现移动设备所在的被访网络，这是通过在移动设备的归屈网络中查询 HSS 来完成的，然后通信者将数据报从其网络直接通过隧道发送到移动设备的被访网络的网关路由器

## 移动设备从源基站切换到目标基站的步骤？

1. 当前（源）基站选择目标基站，并向目标基站发送切换请求消息
2. 目标基站检查自己是否有资源来支持移动设备及其业务质量要求
   - 如果是，则在其无线电接入网上为该设备预分配信道资源（例如，时隙）和其他资源
   - 这种资源预分配将移动设备从前面讨论的耗时基站关联协议中解放出来，允许尽可能快地执行切换。目标基站向源基站确认一个切换请求确认报文，该报文包含移动设备需要与新基站关联的目标基站的所有信息
3. 源基站接收到切换请求确认报文，并将目标基站的身份信息和信道接入信息告知移动设备
4. 源基站将它接收到的任何隧道化的数据报转发给目标基站，目标基站随后将这些数据报转发给移动设备
5. 目标基站通知 MME 它（目标基站）将是为移动设备服务的新基站。MME 依次向服务网关和目标基站发出信号，以重新配置服务网关到基站隧道，使其在目标基站而不是源基站终止
6. 目标基站向源基站确认隧道已被重新配置，从而允许源基站释放与该移动设备关联的资源



# 8 计算机网络中的安全

## 安全通信包括哪四个方面的性质
1. **机密性**：仅有发送方和希望的接收方能够理解传输报文的内容。对报文**加密**
2. **报文完整性**：通信的内容在传输过程中未被改变（恶意篡改或意外改动）
3. **端点鉴别**：发送方和接收方都应该能证实通信过程所涉及的另一方，以确信通信的另一方确实具有其所声称的身份 
4. **运行安全性**

## 对称密钥系统与公开密钥系统的区别

报文的最初形式称为**明文**，用户 A 使用**加密算法**加密其明文报文，生成的加密报文称为**密文**，并提供一个**密钥** $K_A$ 作为加密算法的输入。加密算法以密钥和明文报文 $m$ 为输入，生成的密文作为输出。$K_A(m)$ 表示 明文报文 $m$ 的密文形式。用户 B 为**解密算法**提供密钥 $K_B$，将密文和 B 的密钥作为输入，输出初始明文

- 对称密钥系统：A 和 B 的密钥是相同且秘密的
- 公开密钥系统：使用一对密钥，一个密钥公开可知（A 和 B 都知道），另一个密钥只有 A 或 B 知道

## RSA算法的工作原理

1. RSA 的过程

   **公钥**：$K_B^+$，**私钥**：$K_B^-$。$K_B^-(K_B^+(m)) = K_B^+(K_B^-(m)) = m$

   1. 公钥和私钥的选择：
      - 选择两个大素数 $p$ 和 $q$，值越大破解 RSA 越困难，加密解密的时间越长
      - 计算 $n=pq$ 和 $z=(p-1)(q-1)$
      - 选择小于 $n$ 的一个数 $e$，且使 $e$ 和 $z$ 互素
      - 求一个数 $d$，使 $ed-1$ 可以被 $z$ 整除，即 $ed \mod z = 1$
      - 公钥 $K_B^+$ 是一对数 $(n,e)$，其私钥 $K_B^-$  是一对数 $(n,d)$

   2. 加密和解密算法

      - A 发送一个由整数 $m$ 表示的比特组合（$m<n$），A 执行 $m^e$，计算 $m^e$ 被 n 除的整数余数，即，A 的明文报文 m 的加密值 $c = m^e \mod n$，将 $c$ 发送给 B

      - B 解密时计算 $m = c^d \mod n$

2. RSA算法的工作原理

   - 模算数运算的一个重要性质：$(a\mod n)^d \mod n = a^d \mod n$
   - $(m^e \mod n)^d \mod n = m^{ed} \mod n$​
   - 数论中的结论：对于素数 $p$ 和 $q$，且有 $n=pq$ 和 $z=(p-1)(q-1)$，则 $x^y \mod n = x^{(y \mod z)} \mod n$
   - $m^{ed} \mod n = m^{(ed \mod z)} \mod z$，因为 $ed \mod z = 1$，则有 $m^{ed} \mod n = m^1 \mod n =m$

## 密码散列函数的性质

密码散列函数：以 $m$ 为输入，计算得到一个称为散列的固定长度的字符串 $H(m)$​

性质：找到任意两个不同的报文 x 和 y 使得 $H(x)=H(y)$​，在计算上是不可能的

## 数字签名的基本原理

B 生成一个数字签名：用私钥 $K_B^-$ 加密报文 m，$K_B^-(m)$，A 用公钥 $K^+_B$ 解密

## 鉴别协议及其安全性

1. 鉴别协议 ap2.0

   - 如果 A 有一个总是用于通信的周知网络地址，则 B 能够试图通过验证携带鉴别报文的 IP 数据报的源地址是否与 A 的周知 IP 地址相匹配来进行鉴别

   - 安全问题：生成一个 lP 数据报，并在 IP 数据报中填入我们希望的任意源地址，再通过链路层协议把生成的数据报发送到第一跳路由器

2. 鉴别协议 ap3.0

   - 使用秘密口令。口令是鉴别者和被鉴别者之间的一个共享秘密
   - 安全问题：窃听通信，得知口令

3. 鉴别协议 ap3.1

   - 加密口令。
   - 安全问题：回放攻击。窃听通信并记录口令的加密版本

4. 鉴别协议 ap4.0

   - **不重数**：在一个协议的生存期中只使用一次的数 
   - A 向 B 发送报文，B 选择一个不重数 R，然后把这个值发给 A
   - A 用和 B 共享的对称密钥 $K_{A-B}$ 加密不重数，且将加密后的不重数 $K_{A-B}(R)$ 发回给 B，不重数用于确定 A 是活跃的
   - B 解密收到的报文，解密得到的不重数相等，则可鉴别 A 的身份

## IPSec协议族中的两个重要协议

当某源 IPsec 实体向一个目的实体发送安全数据报时，它可以使用 AH 协议或 ESP 协议

1. **鉴别首部（AH）协议**：提供源鉴别和数据完整性服务，不提供机密性服务
2. **封装安全性载荷（ESP）协议**：提供了源鉴别、数据完整性和机密性服务 

## 防火墙包括哪三类？这三类的主要区别？入侵检测系统与防火墙的主要区别

1. 防火墙的类别和区别
   1. 防火墙分为3类：**传统分组过滤器**、**状态过滤器**、**应用程序网关**
   2. **传统分组过滤器**：
      - 一个机构通常都有一个将其内部网络与其 ISP 相连的网关路由器。所有离开和进入内部网络的流量都要经过这个路由器。这个路由器正是进行**分组过滤**之处
      - 分组过滤器独立地检查每个数据报，然后基于管理员特定的规则决定该数据报应当允许通过还是应当丢弃。
      - 过滤决定通常基于下列因素：
        - IP 源或目的地址
        - 在 IP 数据报中的协议类型字段：TCP、UDP、ICMP、OSPF
        - TCP或UDP的源和目的端口
        - TCP标志比特：SYN、ACK 等
        - ICMP 报文类型
        - 数据报离开和进入网络的不同规则
        - 对不同路由器接口的不同规则
   2.  **状态分组过滤器**：
      - 在传统的分组过滤器中，根据每个分组分离地做出过滤决定。状态过滤器实际跟踪 TCP 连接，并使用这种知识作出过滤决定
   3. **应用程序网关**：
      - 分组级过滤使得一个机构可以根据 IP 的内容和 TCP/UDP 首部执行粗粒度过滤
      - 应用程序网关除了看 IP/TCP/UDP 首部外，还基于应用数据来做策略决定
      - 一个应用程序网关是一个应用程序特定的服务器，所有应用程序数据都必须通过它。多个应用程序网关可以在同一主机上运行，但是每一个网关都是有自己的进程的单独服务器

2. 入侵检测系统与防火墙的主要区别

   ![image-20240614163004816](./期末复习/image-20240614163004816.png)
