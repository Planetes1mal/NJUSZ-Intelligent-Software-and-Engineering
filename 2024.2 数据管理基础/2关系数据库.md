[TOC]

# 第2章 关系数据库

## 2.1 关系数据结构及形式化定义

### 2.1.1 关系

关系模型仅有单一的数据结构：关系
关系模型的逻辑结构：二维表

（1）**域**：一组具有相同数据类型的值的集合

（2）**笛卡尔积**：

给定一组域 $D_1，D_2，…，D_n$，允许其中某些域是相同的。
$D_1，D_2，…，D_n$ 的笛卡尔积可表示为：$D_1×D_2×…×D_n$
笛卡尔积的运算结果也是一个集合，其中的每个元素都是一个具有如下形式的**n元组**：$(d_1, d_2, …, d_n)$，其中 $d_i∈D_i (i=1, 2, …, n)$
由所有符合上述要求的‘n元组’组成该笛卡儿积的运算结果，即：$D_1×D_2×…×D_n＝ \{ (d_1, d_2, …, d_n)|d_i \in D_i , i＝1，2，…，n \}$

笛卡尔积的运算结

- 所有域的所有取值的一个组合

- 不存在重复的 n 元组

**元组**：笛卡尔积中每一个元素 $(d_1, d_2, …, d_n)$ 叫作一个n元组(n-tuple)或 n元有序组，简称**元组**

**分量**：笛卡尔积元素 $(d_1, d_2, …, d_n)$ 中的每一个值 $d_i$ 叫作一个**分量**

**基数**：一个域允许的不同取值个数称为这个域的**基数**

若 $D_i (i＝1, 2, …, n)$ 都为有限集，其基数为 $m_i (i＝1, 2, … , n)$，则 $D_1×D_2×…×D_n$ 的基数 M 为：$M = \prod_{i=1}^{n} m_i$

（3）**关系**

$D_1×D_2×…×D_n$ 的子集叫做在域 $D_1，D_2，…，D_n$ 上的**关系**，表示为 $R(D_1，D_2，…，D_n)$，

- R 为关系名
- n 是关系的目或**度**
  - n = 1，一元关系
  - n = 2，二元关系
  - n > 2，n元关系

关系是一张二维表，表每行对应一个元组，每列对应一个域。关系所对应的二维表中的每一列，被称为是该关系中的一个**属性**。n目关系必有n个属性

若关系中的某一属性组的值能唯一地标识一个元组，而其所有的真子集都不能，则称该属性组为关系的**候选码**，简称**码**。若有多个候选码，则选定其中一个为**主码**

由关系中的所有属性构成的属性组是这个关系的候选码，称为**全码**

候选码中的诸属性称为该关系的**主属性**

不包含在任何侯选码中的属性称为该关系的非主属性或**非码属性**

1、关系可以有三种类型

- 基本关系（基本表或基表）：实际存在的表，是实际存储数据的逻辑表示
- 查询表：查询结果对应的表
- 视图表：由基本表或其他视图表导出的表,是虚表,不对应实际存储的数据

2、关系的性质

（1）列是同质的
（2）不同的列可出自同一个域
（3）列的无序性
（4）行的唯一性
（5）行的无序性
（6）分量必须取原子值

### 2.1.2 关系模式

1、关系模式是对关系的描述

2、关系模式的形式化表示：R(U, D, DOM, F)

- R：关系名
- U：组成该关系的属性名集合
- D：U 中属性所来自的域
- DOM：属性向域的映象集合（描述各个属性对应的域）
- F：属性间数据的依赖关系的集合（关系上的完整性约束条件）

3、关系模式通常可以简记为 $R(U)$ 或 $R (A_1，A_2，…，A_n)$

### 2.1.3 关系数据库

1、所有关系的集合

2、关系数据库的型与值

- 型：关系数据库模式
- 值：关系模式在某一时刻对应的关系的集合

### 2.1.4 关系模型的存储结构



## 2.2 关系操作

### 2.2.1 基本的关系操作

集合操作：并、交、差、笛卡尔积
关系操作：选择、投影、连接、除

### 2.2.2 关系数据语言的分类



## 2.3 关系的完整性

关系的值及其随时间变化时应该满足的一些约束条件

### 2.3.1 实体完整性

> [!NOTE]
>
> 规则2.1 **实体完整性规则**
>
> 若属性A是基本关系（基表）的主码中的属性，则属性A不能取“空值”(null)

### 2.3.2 参照完整性

1、关系间的引用

2、外码

设 F 是基本关系 R 的一个或一组属性，但不是关系 R 的码。如果 F 与基本关系 S 的主码 $K_S$ 相对应，则称 F 是关系 R 的外码

基本关系 R 称为参照关系
基本关系 S 称为被参照关系

> [!NOTE]
>
> 规则2.2 **参照完整性规则**
>
> 若属性（或属性组）F 是基本关系 R 的外码，它与基本关系 S 的主码 $K_S$ 相对应（基本关系 R 和 S 不一定是不同的关系），则对于 R 中每个元组在 F 上的值必须为
>
> - 或者取空值（F 的每个属性值均为空值）
> - 或者等于 S 中某个元组的主码值

### 2.3.3 用户定义的完整性

针对某一具体关系数据库的约束条件，反映某一具体应用所涉及的数据必须满足的语义要求

 

## 2.4 关系代数

### 2.4.1 传统的集合运算

- $∪$：并
- $-$：差。关系 R 与关系 S 的差记作 $R-S=\{t|t\in R \and t \notin S\}$
- $∩$：交。$R ∩ S = R -(R-S) =S-(S-R)$
- $×$：笛卡尔积

### 2.4.2 专门的关系运算

- $σ$​：选择
  - $σ_F(R) = \{t|t \in R \and F(t) = true \}$​
  - F：选择条件，是一个逻辑表达式，取值为“真”或“假”
    - 基本形式为：$X_1 \theta Y_1$，$\theta$​ 为比较运算符或逻辑运算符
  - 从关系 R 中选取使逻辑表达式 F 为真的元组
- $\pi$​​：投影
  - 从R 中选择出若干属性列组成新的关系（A 是 R 中的属性列）
  - $\pi_{A}(R) = \{t[A]|t \in R \}$
- $⋈$：连接 - θ连接
  - 从两个关系的笛卡尔积中选取属性间满足一定条件的元组
    $R ⋈_{A θ B} S = \{\overset{\frown}{t_r t_S} | t_r \in R \and t_s \in S \and (t_r[A] θ t_s[B])\}$
    - A 和 B：分别为 A 和 B 上度数相等且可比的属性组
    - θ：比较运算符
      - θ为“＝”的连接运算称为等值连接
      - 自然连接：两个关系中进行比较的分量必须是相同的属性组，在结果中把重复的属性列去掉
        - **悬浮元组**：两个关系 R 和 S 在做自然连接时，关系 R 中某些元组有可能在 S 中不存在公共属性上值相等的元组，从而造成 R 中这些元组在操作时被舍弃了，这些被舍弃的元组称为悬浮元组。
          - 外连接：把悬浮元组也保存在结果关系中，而在其他属性上填空值（NULL）
            - 左外连接：只保留左边关系 R 中的悬浮元组
              右外连接：只保留左边关系 S 中的悬浮元组
- $÷$：除。关系 R(x, y) 和 S(Y, Z)，$R ÷ S =\{t_r[X] | t_r \in R \and \pi_Y(S) \subseteq  Y_x\}$
  - $Y_x$ 是 x 在 R 中的象集，$x = t_r[X]$

### 2.4.3 关系代数的基本运算与扩充运算

并、差、笛卡尔积、选择、投影等五个运算符是关系完备系统，其他运算符都是扩充运算

关系完备系统：采用关系数据结构，且支持关系代数基本运算符

**关系模式的语义**

同名同义：‘属性名相同’表示具有‘相同的属性域和相同的语义’
异名异义：‘属性名不同’表示具有‘不同的属性域或不同的语义’

**关系代数中的 ‘赋值’ 运算**

$:=$ 是赋值运算符，$R(A_1,A_2,...,A_n) := <expression>$

**关系代数中的扩充运算：除**

除运算：$R ÷ S$，用 Head(R) 表示关系 R 的关系模式

假设关系 R 和 S 的关系模式分别为：$Head(R) = \{ A_1,A_2,...,A_n,B_1,B_2,...,B_m \}$，$Head(S) = \{ B_1,B_2,...,B_m \}$

结果关系：$T = R ÷ S =\{t_r[X] | t_r \in R \and \pi_Y(S) \subseteq  Y_x\}$

结果关系的关系模式：$Head(T) = Head(R) - Head(S) = \{ A_1,A_2,...,A_n \} = X$

结果关系中的元组：假设 x 是结果关系 T 中的一个元组 (x ∈ T)，则对于除数关
系 S 中的每一个元组 y 都有 (x, y) ∈R

**除运算与笛卡儿积的关系**

如果 $R = T × S$，那么有：$T = R ÷ S$，$S = R ÷ T$
如果 $T = R ÷ S$，那么有：$T × S \subseteq R$

**除法的推导公式**

设关系 R 的属性集为 $\{ A_1,A_2,...,A_n,B_1,B_2,...,B_m \}$，关系 S 的属性集为 $\{ B_1,B_2,...,B_m \}$，则 $R ÷ S = \pi_{A_1,..,A_n}(R) - \pi_{A_1,...,A_n}((\pi_{A_1,..,A_n}(R) × S)-R)$

## 2.5 关系代数的应用

### 2.5.1 MyCAP数据库

求解过程
1) 确定查询目标（确定结果关系的关系模式）
2) 明确查询条件（确定结果元组的语义）
3) 选择从条件到目标的查找路径，并据此确定操作对象，即：
  - 在操作过程中需要使用到那些关系?
  - 这些关系又是如何联合起来实现查询的?
4) 根据以上分析构造关系代数表达式

### 2.5.2 基本运算符的查询表示

### 2.5.3 扩充运算符的查询表
